<!DOCTYPE html>
<html lang="en"><head>

  <meta name="generator" content="Hugo 0.71.1" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Pang Yan Han"><meta name="keywords" content="haskell,cabal,yesod"><meta property="og:title" content="cabal - installing test dependencies" />
<meta property="og:description" content="Update Dec 2017: Dear reader, this post was written in a time when Stack did not exist and Haskell users had to deal with cabal directly. For most intents and purposes, you will have a much better experience using Stack.
That being said, the content of this post should still be valid.
 If there is one serious pain point I&rsquo;ve always felt about Haskell, it is the lack of documentation, or if documentation available, it&rsquo;s usually very terse and feels like it&rsquo;s meant more for experts than for beginners." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yanhan.github.io/posts/2013-12-22-cabal-installing-test-dependencies/" />
<meta property="article:published_time" content="2013-12-22T11:05:00+00:00" />
<meta property="article:modified_time" content="2013-12-22T11:05:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="cabal - installing test dependencies"/>
<meta name="twitter:description" content="Update Dec 2017: Dear reader, this post was written in a time when Stack did not exist and Haskell users had to deal with cabal directly. For most intents and purposes, you will have a much better experience using Stack.
That being said, the content of this post should still be valid.
 If there is one serious pain point I&rsquo;ve always felt about Haskell, it is the lack of documentation, or if documentation available, it&rsquo;s usually very terse and feels like it&rsquo;s meant more for experts than for beginners."/>

  <link rel="stylesheet" type="text/css" media="screen" href="https://yanhan.github.io/css/normalize.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://yanhan.github.io/css/main.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://yanhan.github.io/css/all.css" />
<link rel="stylesheet" type="text/css" media="screen" href="https://yanhan.github.io/css/custom.css" /><title>cabal - installing test dependencies | Yan Han&#39;s blog</title></head>
<body><header>

  <div id="titletext"><h2 id="title"><a href="https://yanhan.github.io/">Yan Han&#39;s blog</a></h2></div>
  <div id="title-description"><p id="subtitle">On Computer Technology</p><div id=social>
    <nav>
      <ul><li><a href="https://github.com/yanhan"><i title="GitHub" class="icons fab fa-github"></i></a></li><li><a href="/index.xml"><i title="RSS" class="icons fas fa-rss"></i></a></li></ul>
    </nav>
  </div>
  </div>
  <div id="mainmenu">
    <nav>
      <ul>
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/about">About</a></li>
        
        <li><a href="/bookshelf">Bookshelf</a></li>
        
        <li><a href="/posts">All Posts</a></li>
        
        <li><a href="/tags">Tags</a></li>
        
      </ul>
    </nav>
  </div>
</header>
<main><div class="post">
<div class="author">

</div>
<div class="post-header">

<div class="meta">

<div class="date">
<span class="day">22</span>
<span class="rest">Dec 2013</span>
</div>

</div>

<div class="matter">
<h1 class="title">cabal - installing test dependencies</h1>
</div>
</div>

<div class="tags">









<table>
  <tbody>
    <tr>
      <td>
        <p>Tags</p>
      </td>
      <td class="tagvalues">
        <p>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href="/tags/cabal/"> cabal </a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href="/tags/haskell/"> haskell </a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href="/tags/yesod/"> yesod </a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </td>
    </tr>
  </tbody>
</table>
</div>





</div>

<div class="markdown">
<p><strong>Update Dec 2017:</strong> Dear reader, this post was written in a time when <a href="https://www.haskellstack.org/">Stack</a> did not exist and Haskell users had to deal with cabal directly. For most intents and purposes, you will have a much better experience using <a href="https://www.haskellstack.org/">Stack</a>.</p>
<p>That being said, the content of this post <em>should</em> still be valid.</p>
<hr>
<p>If there is one serious pain point I&rsquo;ve always felt about Haskell, it
is the lack of documentation, or if documentation available, it&rsquo;s usually
very terse and feels like it&rsquo;s meant more for experts than for beginners.</p>
<p>This short article will show you how to install test dependencies for a
cabalized project using cabal. The longer version is centred around Yesod,
but should be generally applicable. There is a tldr version available
below.</p>
<h2 id="software-involved">Software involved:</h2>
<ul>
<li>ghc 7.4.1</li>
<li>cabal 1.18.0.2</li>
<li>yesod 1.2.4</li>
<li>yesod-bin 1.2.5.1</li>
</ul>
<h2 id="tldr-version">tldr version</h2>
<p>In short, suppose you have a cabalized project, and somehow when you run
its test suite, cabal complains about missing dependencies. Now, inside
the <code>.cabal</code> file of the project, you should find a section beginning with
a line that looks something like this:</p>
<pre><code>test-suite test
</code></pre>
<p>and below it, there are some <code>build-depends</code> that look like libraries meant
for testing.
If so, then you are in luck. Simply execute the following commands:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cabal configure --enable-tests
cabal install --only-dependencies --enable-tests
</code></pre></div><p>And cabal will go on to install the test dependencies. Once that is done,
you should be able to run the test suite.</p>
<p>For a longer version of how I derived the above, read on.</p>
<h2 id="long-version">Long version</h2>
<p>I was fiddling around with setting up a Yesod scaffolded site, and
it went like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yesod init
cd yesodtry <span style="color:#f92672">&amp;&amp;</span> cabal sandbox init <span style="color:#f92672">&amp;&amp;</span> cabal install <span style="color:#f92672">&amp;&amp;</span> yesod devel
</code></pre></div><p>So my project is named <code>yesodtry</code>. Everything went smoothly, and the
Yesod scaffolding comes with a &quot;demo&quot; site, that looks like
this:</p>
<p><img src="/images/2013-12-22/yesod_demo_site.png" alt=""></p>
<p>I noticed the <code>yesod test</code> line, and curiosity got the better of me.
So I proceeded to enter <code>yesod test</code> onto the command line, and this
was what I got:</p>
<pre><code>Resolving dependencies...
Configuring yesodtry-0.0.0...
cabal: At least the following dependencies are missing:
hspec -any, yesod-test ==1.2.*
</code></pre>
<p>Ok, but I noticed that inside <code>yesodtry.cabal</code>, there is a <code>test-suite test</code>
section, that looks like this:</p>
<pre><code>test-suite test
    type:              exitcode-stdio-1.0
    main-is:           main.hs
    hs-source-dirs:    tests
    ghc-options:       -Wall

    build-depends: base
                 , yesodtry
                 , yesod-test &gt;= 1.2 &amp;&amp; &lt; 1.3
                 , yesod-core
                 , yesod
                 , persistent
                 , persistent-sqlite
                 , resourcet
                 , monad-logger
                 , transformers
                 , hspec
</code></pre>
<p>Notice the <code>yesod-test &gt;= 1.2 &amp;&amp; &lt; 1.3</code> line. So somehow cabal is not
installing that dependency. Out of desperation, I tried
<code>cabal build test</code>, and I got:</p>
<pre><code>cabal: Cannot build the test suite 'test' because test suites are not enabled.
Run configure with the flag --enable-tests
</code></pre>
<p>Ok, so it&rsquo;s telling me to run <code>cabal configure --enable-tests</code>. Below
is its output:</p>
<pre><code>Resolving dependencies...
Configuring yesodtry-0.0.0...
cabal: At least the following dependencies are missing:
hspec -any, yesod-test ==1.2.*
</code></pre>
<p>which was the exact same output I got from running <code>yesod test</code> !!!
So it seems like we&rsquo;re in a vicious cycle here, with no way out&hellip;</p>
<p>So I proceeded to ask a <a href="http://stackoverflow.com/questions/20725611/yesod-test-missing-dependency-yesod-test">question on stack overflow</a>.
After a few minutes, no one responded, and I could not find similar
questions. A lucky google search yielded the following link:</p>
<pre><code>https://groups.google.com/forum/#!topic/haskell-cafe/SFoNwaq8wdc
</code></pre>
<p>Which is an announcement for the release of cabal 1.18.0, and seemingly
has nothing to do with our problem, until the following lines in the
announcement:</p>
<pre><code>* GHCi support. It's now much easier to use ghci when developing your
packages, especially if those packages require preprocessors (e.g.
hsc2hs).

Here's how working on a package might look like using the new features:

    # Only once:
    cabal sandbox init
    cabal install --only-dependencies --enable-tests
    # Configure, build, and run tests:
    cabal test  # now implies configure and build
    # Play around with the code in GHCi:
    cabal repl
</code></pre>
<p>In particular, the <code>cabal install --only-dependencies --enable-tests</code> line.
Could that be the magic one liner needed to solve our problems? Fortunately,
yes.</p>
<p>So I proceeded with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cabal install --only-dependencies --enable-tests
</code></pre></div><p>and cabal goes on to install the dependencies for the <code>test-suite test</code>
section.</p>
<p>Then, I proceeded to run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yesod test
</code></pre></div><p>And here&rsquo;s the last few lines of output:</p>
<pre><code>Linking dist/build/test/test ...
Building yesodtry-0.0.0...
Preprocessing library yesodtry-0.0.0...
In-place registering yesodtry-0.0.0...
Preprocessing test suite 'test' for yesodtry-0.0.0...
Linking dist/build/test/test ...
Running 1 test suites...
Test suite test: RUNNING...
Test suite test: PASS
Test suite logged to: dist/test/yesodtry-0.0.0-test.log
1 of 1 test suites (1 of 1 test cases) passed.
</code></pre>
<p>And I felt a sense of accomplishment&hellip; even though I wasn&rsquo;t really
interested in learning how to test a yesod web app at this point in time.</p>

</div>

<div class="disclaimer">
  <p>Disclaimer: Opinions expressed on this blog are solely my own and do not express the views or opinions of my employer(s), past or present.</p>
</div><div id="disqus_thread"></div>
<script type="text/javascript">

(function () {
  
  
  if (window.location.hostname == "localhost")
    return;

  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  var disqus_shortname = 'pangyanhan';
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the</a></noscript>
<a href="http://disqus.com/">comments powered by <span>Disqus</span></a>
</div>

</main><footer>
 Â© Copyright 2013 Yan Han Pang | <a href="https://github.com/dataCobra/hugo-vitae">Vitae</a> theme for <a href="https://gohugo.io">Hugo</a> 


    

</footer>
</body>
</html>
