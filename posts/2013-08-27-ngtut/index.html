<!DOCTYPE html>
<html lang="en"><head>

  <meta name="generator" content="Hugo 0.96.0" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Pang Yan Han"><meta name="keywords" content="angularjs,javascript"><meta property="og:title" content="A very long AngularJS tutorial" />
<meta property="og:description" content="Update Dec 2017: Dear reader, this post was written in 2013 and covers Angular JS 1.0, which is very ancient. In case you are thinking it is still relevant to new versions of Angular, you are wrong, at least based on what I hear from others about newer versions of Angular. I have not done any serious frontend programming for a long time and will not be updating this post." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yanhan.github.io/posts/2013-08-27-ngtut/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-08-27T00:12:00+00:00" />
<meta property="article:modified_time" content="2013-08-27T00:12:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="A very long AngularJS tutorial"/>
<meta name="twitter:description" content="Update Dec 2017: Dear reader, this post was written in 2013 and covers Angular JS 1.0, which is very ancient. In case you are thinking it is still relevant to new versions of Angular, you are wrong, at least based on what I hear from others about newer versions of Angular. I have not done any serious frontend programming for a long time and will not be updating this post."/>

  <link rel="stylesheet" type="text/css" media="screen" href="https://yanhan.github.io/css/normalize.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://yanhan.github.io/css/main.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="https://yanhan.github.io/css/all.css" />
<link rel="stylesheet" type="text/css" media="screen" href="https://yanhan.github.io/css/custom.css" /><title>A very long AngularJS tutorial | Yan Han&#39;s blog</title><script type="text/javascript">(function(c,a){if(!a.__SV){var b=window;try{var d,m,j,k=b.location,f=k.hash;d=function(a,b){return(m=a.match(RegExp(b+"=([^&]*)")))?m[1]:null};f&&d(f,"state")&&(j=JSON.parse(decodeURIComponent(d(f,"state"))),"mpeditor"===j.action&&(b.sessionStorage.setItem("_mpcehash",f),history.replaceState(j.desiredHash||"",c.title,k.pathname+k.search)))}catch(n){}var l,h;window.mixpanel=a;a._i=[];a.init=function(b,d,g){function c(b,i){var a=i.split(".");2==a.length&&(b=b[a[0]],i=a[1]);b[i]=function(){b.push([i].concat(Array.prototype.slice.call(arguments,0)))}}var e=a;"undefined"!==typeof g?e=a[g]=[]:g="mixpanel";e.people=e.people||[];e.toString=function(b){var a="mixpanel";"mixpanel"!==g&&(a+="."+g);b||(a+=" (stub)");return a};e.people.toString=function(){return e.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");for(h=0;h<l.length;h++)c(e,l[h]);var f="set set_once union unset remove delete".split(" ");e.get_group=function(){function a(c){b[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));e.push([d,call2])}}for(var b={},d=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<f.length;c++)a(f[c]);return b};a._i.push([b,d,g])};a.__SV=1.2;b=c.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL? MIXPANEL_CUSTOM_LIB_URL:"file:"===c.location.protocol&&"//cdn4.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn4.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn4.mxpnl.com/libs/mixpanel-2-latest.min.js";d=c.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d)}})(document,window.mixpanel||[]);mixpanel.init("49f4d9dd919ecb7ee428489acdd19dff");</script>
</head>
<body><header>

  <div id="titletext"><h2 id="title"><a href="https://yanhan.github.io/">Yan Han&#39;s blog</a></h2></div>
  <div id="title-description"><p id="subtitle">On Computer Technology</p><div id=social>
    <nav>
      <ul><li><a href="https://github.com/yanhan"><i title="GitHub" class="icons fab fa-github"></i></a></li><li><a href="/index.xml"><i title="RSS" class="icons fas fa-rss"></i></a></li></ul>
    </nav>
  </div>
  </div>
  <div id="mainmenu">
    <nav>
      <ul>
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/about">About</a></li>
        
        <li><a href="/bookshelf">Bookshelf</a></li>
        
        <li><a href="/posts">All Posts</a></li>
        
        <li><a href="/tags">Tags</a></li>
        
      </ul>
    </nav>
  </div>
</header>
<main><div class="post">
<div class="author">

</div>
<div class="post-header">

<div class="meta">

<div class="date">
<span class="day">27</span>
<span class="rest">Aug 2013</span>
</div>

</div>

<div class="matter">
<h1 class="title">A very long AngularJS tutorial</h1>
</div>
</div>

<div class="tags">









<table>
  <tbody>
    <tr>
      <td>
        <p>Tags</p>
      </td>
      <td class="tagvalues">
        <p>
        
        
        
        
        
        
        
        <a href="/tags/angularjs/"> angularjs </a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href="/tags/javascript/"> javascript </a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </td>
    </tr>
  </tbody>
</table>
</div>





</div>

<div class="markdown">
<p><strong>Update Dec 2017:</strong> Dear reader, this post was written in 2013 and covers Angular JS 1.0, which is very ancient. In case you are thinking it is still relevant to new versions of Angular, you are wrong, at least based on what I hear from others about newer versions of Angular. I have not done any serious frontend programming for a long time and will not be updating this post.</p>
<hr>
<p><strong>NOTE:</strong> This is a <strong>very</strong> long post. I tend to be relatively verbose when the
situation requires it. This is one of those situations. Do not read this unless
you have at least an afternoon&rsquo;s worth of time to spend on it.</p>
<h2 id="introduction">Introduction</h2>
<p>This is an introductory AngularJS tutorial based on my roughly 2 to 3 months
of experience with it during my summer internship at
<a href="http://www.billpin.com">BillPin</a>. It assumes no knowledge whatsoever about
AngularJS and similar MVC/MVVM frameworks. However, working knowledge of
JavaScript, some web development experience, familiarity with Git and
installation of software on a Linux system is assumed.</p>
<h2 id="why-another-angularjs-tutorial">Why another AngularJS tutorial</h2>
<p>So during my internship, I&rsquo;ve met quite a few AngularJS developers,
and if there is one thing we all agree on <!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->,
it is this - with regards to documentation for AngularJS, there is room for
improvement. Towards the end of my internship, I feel that I have accumulated
some working knowledge of AngularJS, and I have felt like writing a tutorial,
except that you know, I was feeling lazy.</p>
<p>Fast-forward about 1 week and a
good friend of mine asks me my opinions about AngularJS and how he&rsquo;s going
through the tutorial on the official site. While it might help a bit, I feel
that the tutorial is miles away from how real AngularJS applications are
implemented, at least based on the limited experience I&rsquo;ve had, having gone
through the entire tutorial myself.
And that was the final straw - I simply had to write an AngularJS tutorial.</p>
<h2 id="selling-points">Selling Points</h2>
<p>What might possibly make this tutorial different from others:</p>
<ul>
<li>It features a &ldquo;full-stack&rdquo; web application in the form of a todo list.</li>
</ul>
<p>Don&rsquo;t ask me why a todo list, I simply can&rsquo;t think of a simpler application.
The frontend code is in AngularJS and there is a backend written in Python
(using the Flask framework). However, emphasis will be placed on the AngularJS
code, so I will not go too in-depth into the explanation of the Python code.
Don&rsquo;t worry if you don&rsquo;t know Python or if you don&rsquo;t know Flask. The backend
code is very simple and the concepts are transferrable to other frameworks.</p>
<ul>
<li>Code for the application is provided</li>
</ul>
<p>The repository is housed at
<a href="https://github.com/yanhan/ngtut">https://github.com/yanhan/ngtut</a> .
You should clone the repository and run the application on your own
machine to get the most out of this tutorial.</p>
<ul>
<li>It is probably more real world than other tutorials</li>
</ul>
<p>Or at least I hope that is the case. Even though this is a single page app,
the AngularJS conventions used should be similar to those found in
real applications.</p>
<ul>
<li>Very detailed explanations provided</li>
</ul>
<p>I have assumed the reader to be a total beginner in AngularJS, so I have
spent a lot of effort in explaining AngularJS concepts in detail, and in
as clear a manner as I am able to.</p>
<ul>
<li>Working unit tests are included, including sections covering unit testing
AngularJS applications</li>
</ul>
<p>If there is one thing I really like about AngularJS, it is the testability.
AngularJS makes it <strong>really</strong> easy for you to test your applications.
Imho that is one killer advantage of AngularJS over its competitors.
In this tutorial, I hope to shed some light into how you can go about testing
your own AngularJS applications based on the test cases I&rsquo;ve written for the
todo list application featured here.</p>
<h2 id="disclaimer--some-notes-of-caution">Disclaimer / Some notes of caution</h2>
<p>In my opinion, I am not a very experienced AngularJS developer or even an
experienced web developer. As such, I may have made mistakes in terminology.
In addition, while I do think the practices shown here are good practices,
they may not be the best practices.</p>
<p>Furthermore, the application showcased here was not engineered with
security in mind. There are many ways one can exploit this application.
Please take that into account when you are designing your own application,
as AngularJS does have its own built-in security features, which will not
be covered here.</p>
<p>With that said, let&rsquo;s go on to the tutorial proper.</p>
<h2 id="system-requirements">System requirements</h2>
<p>It is assumed that you are using Linux or a UNIX like operating system.</p>
<p>In addition, we will need several pieces of software to run the application.
They are:</p>
<ul>
<li>Python 2.7x</li>
<li>virtualenv (for Python 2.7x)</li>
</ul>
<p>Please install them before you proceed.</p>
<h2 id="getting-the-code">Getting the code</h2>
<p>I have set up a Git repository <a href="https://github.com/yanhan/ngtut">here</a>.
To get the most out of this tutorial, you should clone it.</p>
<h2 id="file-organization">File Organization</h2>
<p>The repository looks like this:</p>
<pre><code>ngtut
 |- README.md
 |- setup.sh
 |- todoModel.py
 |- todo.py
 |- todoView.py
 |- setup
 |   |- createtable.sql
 |
 |- static
 |   |- navtabs.html
 |   |- secondPage.html
 |   |- todo.html
 |   |- todo.js
 |
 |- templates
 |   |- layout.html
 |   |- main.html
 |
 |- test
     |- test.conf.js
     |- lib
     |   |- angular.min.js
     |   |- angular-mocks.js
     |   |- jquery-1.10.2.min.js
     |
     |- unit
         |- SecondController.spec.js
         |- TodoController.spec.js
         |- TodoDirectives.spec.js
</code></pre>
<p>The <strong>*.py</strong> files on the top level and the entire <strong>templates</strong> folder are
part of the flask backend.</p>
<p>The <strong>static</strong> folder is for the AngularJS portion of the application, and the
<strong>test</strong> folder is used to house its tests.</p>
<h2 id="setting-up">Setting up</h2>
<p>Before running the application, you will need to run the <strong>setup.sh</strong> file,
which creates a sqlite3 database, sets up a virtualenv folder, and installs
flask into that virtualenv:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./setup.sh
</span></span></code></pre></div><p>You should see a file named <strong>db.db</strong> and a folder named <strong>venv</strong> in the
directory.</p>
<h2 id="running-the-application">Running the application</h2>
<p>On the command prompt, enter (The first character here is a period):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>. venv/bin/activate
</span></span></code></pre></div><p>Followed by:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python todo.py
</span></span></code></pre></div><p>Now, go to http://127.0.0.1:5000 and you should see the application, in its
full glory (or ugliness):</p>
<p><img src="/images/2013-08-27-ngtut/todolist01.png" alt=""></p>
<p>Try playing around with it by adding a few items. You should see the new items
added without page refreshes. By default, you can see up to a total of 5 items.
Click on the &lsquo;Retrieve last 10 items&rsquo; or the &lsquo;Retrieve last 15 items&rsquo; button to
see more items.</p>
<p>Now, close off your browser and go back to the todo list page.
There should be no items on the list.
But fret not. Click on the &ldquo;Retrieve last 5 items&rdquo; button.
You should see the last five items you&rsquo;ve inserted. The persistence here is
due to the use of a sqlite database to store the items (it is created by the
<strong>setup.sh</strong> script).</p>
<h2 id="a-high-level-overview-of-the-application">A high level overview of the application</h2>
<p>Now, I wish to give a high level overview of the application, starting from
the moment you hit the url <code>http://127.0.0.1:5000</code>. Most of this section covers
the Flask backend. <strong>Don&rsquo;t worry</strong> if you are not familiar with Flask and do not
understand it entirely.</p>
<p>Open the <strong>todo.py</strong> file, and look at lines 7 and 8:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>app<span style="color:#f92672">.</span>add_url_rule(<span style="color:#e6db74">&#39;/&#39;</span>, view_func<span style="color:#f92672">=</span>TodoView<span style="color:#f92672">.</span>as_view(<span style="color:#e6db74">&#39;todo_view&#39;</span>),
</span></span><span style="display:flex;"><span>    methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;GET&#39;</span>])
</span></span></code></pre></div><p>When you hit the url <code>http://127.0.0.1:5000</code>, it matches the <code>/</code> endpoint,
specified above, so control passes over to the MethodView <strong>TodoView</strong>,
located at <strong>todoView.py</strong>, lines 9 to 11:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TodoView</span>(flask<span style="color:#f92672">.</span>views<span style="color:#f92672">.</span>MethodView):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;main.html&#39;</span>)
</span></span></code></pre></div><p>This view is very simple. It simply returns the <strong>main.html</strong> template,
located at <strong>templates/main.html</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jinja" data-lang="jinja"><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">extends</span> <span style="color:#e6db74">&#34;layout.html&#34;</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">block</span> content <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>&lt;div ng-app=&#34;TodoApp&#34;&gt;
</span></span><span style="display:flex;"><span>  &lt;div ng-view&gt;&lt;/div&gt;
</span></span><span style="display:flex;"><span>&lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;script src=&#34;/static/todo.js&#34;&gt;
</span></span><span style="display:flex;"><span>&lt;/script&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">endblock</span> content <span style="color:#75715e">%}</span>
</span></span></code></pre></div><p>This is written in the Jinja2 templating language. Basically, the
<strong>templates/main.html</strong> page inherits the <strong>templates/layout.html</strong> page, and
on top of that, it includes the stuff between the
<code>{% block content %}</code> and the <code>{% endblock content %}</code>
delimiters where they are located from the inherited template.</p>
<p>A quick look at <strong>templates/layout.html</strong> will show the same 2 delimiters, and
lines 2 to 8 of the <code>&lt;head&gt;</code> section are shown here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p>We include the jQuery 1.10.2, AngularJS 1.0.7 libraries and Twitter Bootstrap 3.0.0.
If you require jQuery, remember to include it <strong>before</strong> AngularJS.
AngularJS has its own version of jQuery called jqlite, which is a subset of
jQuery. jqlite is used as a fallback to jQuery should the need arises, such
as when you use jQuery functionality within AngularJS and the jQuery library
is not included.
As long as you include the jQuery library before AngularJS, AngularJS will
make use of jQuery instead of jqlite.</p>
<p>Going back to the <strong>templates/main.html</strong> file, and looking at the purely
html parts:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">ng-app</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;TodoApp&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">ng-view</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/todo.js&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p>Most of these should look familiar, except the weird looking <code>ng-app</code> and
<code>ng-view</code> portions. <code>ng-app</code> and <code>ng-view</code> are AngularJS <strong>directives</strong>,
which is one of AngularJS&rsquo; defining features. In short, think of
a <strong>directive</strong> as a <strong>domain specific language</strong>. It should come as no
surprise to you that you can implement your own directives, which will
be no less powerful than the ones provided by AngularJS, although that
is a more advanced topic, which we only take a brief look at in a much
later section of this tutorial.</p>
<p>Now, look at the <code>&lt;script&gt;</code> tag. It includes the <strong>/static/todo.js</strong> file.
That file contains an AngularJS <strong>module</strong> named
<strong>TodoApp</strong>, which is referenced in the <code>ng-app=&quot;TodoApp&quot;</code> directive of the
topmost <code>&lt;div&gt;</code> element. According to the AngularJS documentation on <code>ngApp</code>
<a href="http://docs.angularjs.org/api/ng.directive:ngApp">here</a>, one HTML document
can have only one <code>ngApp</code> directive, and it is from that HTML element onwards
where AngularJS &ldquo;takes control&rdquo;. Specifically, the AngularJS module <code>TodoApp</code>
takes control.
So there we have it, now we know that this is a page for the <code>TodoApp</code> module.
The <code>ng-view</code> directive will be explained shortly.</p>
<p>Recalling what we have learnt about the application so far:</p>
<ol>
<li>We go to the url <code>http://127.0.0.1:5000</code></li>
<li>Flask recognizes it as a request for the endpoint <code>/</code>, which is handled
by a MethodView called <code>TodoView</code>, and passes control to it.</li>
<li>The <code>TodoView</code> MethodView returns the <strong>templates/main.html</strong> template,
after doing some processing of its own. This template contains a <code>&lt;div&gt;</code>
with the weird looking <code>ng-app</code> directive.</li>
</ol>
<p>But that still does not explain how we get the text box and buttons,
considering that all we see don&rsquo;t see anything like that in the
<strong>templates/main.html</strong> file. We will be getting to that shortly.</p>
<h2 id="the-foundation-of-angularjs-applications---modules">The foundation of AngularJS applications - modules</h2>
<p>A full fledged AngularJS application will consist of multiple <strong>modules</strong>.
For those of you coming from a Python background, you can think of an AngularJS
module as a Python module. In AngularJS, a module is unit of code organization,
where you can store <strong>controllers</strong>, <strong>factories</strong>, <strong>directives</strong> and the
other AngularJS goodies.</p>
<p>We know from the last section that our module of interest is the <code>TodoApp</code>
module, located at <strong>static/todo.js</strong>.
Open that file, and look at lines 1 and 2:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">angular</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">module</span>(<span style="color:#e6db74">&#39;TodoApp&#39;</span>, [])
</span></span></code></pre></div><p>These two lines create a new AngularJS module called <code>TodoApp</code>. The <code>[]</code>
argument is used to specify dependencies (which are themselves modules).
Because our application is so simple, we only have one module and it is
standalone.</p>
<h2 id="angularjs-concept---routes">AngularJS concept - Routes</h2>
<p>Next, turn your attention to lines 3 to 14:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">config</span>([<span style="color:#e6db74">&#39;$routeProvider&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$routeProvider</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$routeProvider</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">when</span>(<span style="color:#e6db74">&#39;/&#39;</span>, {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">templateUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;../static/todo.html&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">controller</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;TodoController&#39;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">when</span>(<span style="color:#e6db74">&#39;/secondPage&#39;</span>, {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">templateUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;../static/secondPage.html&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">controller</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;SecondController&#39;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">otherwise</span>({ <span style="color:#a6e22e">redirectTo</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;/&#39;</span> });
</span></span><span style="display:flex;"><span>}])
</span></span></code></pre></div><p>This is a way to configure <strong>routes</strong> using the <code>routeProvider</code> <strong>service</strong>.
As a convention, services in AngularJS begin with a <code>$</code>. In short, a service
is a singleton that offers some kind of useful functionality.
Personally, I have not written any service of my
own<!-- raw HTML omitted --><!-- raw HTML omitted -->2<!-- raw HTML omitted --><!-- raw HTML omitted -->, so I guess I am not the
right person to explain it. You might want to check out
<a href="http://stackoverflow.com/questions/15666048/angular-js-service-vs-provider-vs-factory">this</a>
Stack Overflow question for a better explanation on services than I can provide.</p>
<p>Ignore the weird looking array notation and the <code>&quot;$routeProvider&quot;</code> string for
now, we will explain that in a later section.</p>
<p>Back to our main topic. The <code>$routeProvider</code> service has two methods, <code>when</code>
and <code>otherwise</code>. The <code>when</code> method takes in 2 arguments, the first is a route,
and the second is an object specfiying what to do when AngularJS sees that
route. Looking at the AngularJS documentation for <code>$routeProvider</code>
<a href="http://docs.angularjs.org/api/ngRoute.$routeProvider">here</a>,
the object in the second argument can be pretty complicated, but imho the most
useful properties, which are the ones I have used so far, are
<code>templateUrl</code> and <code>controller</code>.</p>
<p>The <code>templateUrl</code> property specifies the path to the HTML file<!-- raw HTML omitted --><!-- raw HTML omitted -->3<!-- raw HTML omitted --><!-- raw HTML omitted -->
to be displayed when the <code>TodoApp</code> AngularJS module encounters the given route.
But where does it insert this HTML? Inside an <code>ng-view</code>.
If we look at lines 5 to 7 of <strong>templates/main.html</strong> which we have seen
earlier, there is indeed an <code>ng-view</code> directive at the inner <code>&lt;div&gt;</code> element:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">ng-app</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;TodoApp&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">ng-view</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span></code></pre></div><p>Therefore, when the <code>TodoApp</code> module sees a request for the route <code>/</code>, it
inserts the contents of the HTML file <strong>/static/todo.html</strong> within the inner
<code>&lt;div&gt;</code> element. And indeed, if we open up the <strong>static/todo.html</strong> file,
we see a form element, the three buttons and a table.</p>
<p>So this explains the use of the <code>ng-view</code> directive.</p>
<p>As for the <code>controller</code> property, it specifies the <code>controller</code> to be used.
In AngularJS, controllers are used to set up initial state and adding
behavior to <strong>scope</strong> objects. We will cover controllers shortly.
For now, it suffices to know that when the <code>TodoApp</code> module sees a request for
the route <code>/</code>, it associates a new <strong>scope</strong> object with a controller named
<code>TodoController</code>.</p>
<p>Notice that we have chained a second <code>when</code> method. That is for another page
accessible by clicking on the tab labelled <strong>Second Page</strong>:</p>
<p><img src="/images/2013-08-27-ngtut/todolist02.png" alt=""></p>
<p>Notice how the contents of the page changes, without a page refresh.
In addition, observe that the url changes to:</p>
<pre><code>http://127.0.0.1:5000/#/secondPage
</code></pre>
<p>from the original:</p>
<pre><code>http://127.0.0.1:5000/#/
</code></pre>
<p>Observe that the parts after the <code>#</code> character are exactly the routes we
specify to the <code>$routeProvider</code> service.</p>
<p>Now, enter the following url into your browser:</p>
<pre><code>http://127.0.0.1:5000/#/nonexistent
</code></pre>
<p>This should take you back to our original page, and that is the purpose
of the <code>otherwise</code> method at line 13 of <strong>static/todo.js</strong>, after
the <code>when</code> method calls:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">otherwise</span>({ <span style="color:#a6e22e">redirectTo</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;/&#39;</span> });
</span></span></code></pre></div><p>Any unmatched route (one not specified through <code>$routeProvider.when</code> method
calls) like <code>'/nonexistent'</code> falls through to the route specified
in the <code>otherwise</code> method. While this is optional, I highly recommend you
specify a default route using the <code>$routeProvider.otherwise</code> method when
making use of the <code>$routeProvider</code> service.</p>
<h2 id="a-note-on-the-format-of-the-templateurl">A note on the format of the templateUrl</h2>
<p>The more curious may ask why the following templateUrls in <strong>static/todo.js</strong>
are relative paths beginning with &lsquo;..&rsquo;:</p>
<pre><code>../static/todo.html
../static/secondPage.html
</code></pre>
<p>This is due to the way Flask works with regards to serving static files,
and has nothing to do with AngularJS. Please do not be too bothered by this.</p>
<h2 id="angularjs-concept---controller-model">AngularJS concept - Controller, Model</h2>
<p>Still at <strong>static/todo.js</strong>, look at lines 21 to 30:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">controller</span>(<span style="color:#e6db74">&#39;TodoController&#39;</span>, [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$http&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;windowAlert&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>, <span style="color:#a6e22e">$http</span>, <span style="color:#a6e22e">windowAlert</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">RETRIEVE_DEFAULT_NR</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">todoList</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">RETRIEVE_DEFAULT_NR</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">pageName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;todoList&#39;</span>;
</span></span></code></pre></div><p>Within the <code>TodoApp</code> module, we create a controller named <code>TodoController</code>.
Recall from the previous section that this is the controller used when the
module sees a request for the route <code>/</code>.</p>
<p>In AngularJS, <strong>Controllers</strong> are used to set up initial state in a
<strong>scope</strong> object and augment its functionality. I know we&rsquo;re just getting
started with AngularJS, but I want to say this now: <strong>it is bad practice to
do any kind of DOM manipulation in controllers.</strong> <!-- raw HTML omitted --><!-- raw HTML omitted -->4<!-- raw HTML omitted --><!-- raw HTML omitted -->
If there is only one thing you get out of this tutorial, this should be it.</p>
<p>Controllers in AngularJS are functions. Each of the parameters in the function
are its <strong>dependencies</strong>. We can see that <code>TodoController</code> is dependent on
<code>$scope</code>, the <code>$http</code> service, and a <code>windowAlert</code> factory (this <code>windowAlert</code>
factory is not part of AngularJS, but implemented by me).</p>
<p>Lines 26 to 30 show some assignments to properties within the <code>$scope</code> object.
The <code>$scope</code> object here is part of <!-- raw HTML omitted --><!-- raw HTML omitted -->5<!-- raw HTML omitted --><!-- raw HTML omitted -->
the <strong>Model</strong>.
In AngularJS, the Model should be the one and only source of truth with
regards to application state.</p>
<p>The more interesting state variable to us is <code>$scope.state.todoList</code>.
Initially, this is set to the array <code>[]</code>, which is why we do not see any
todo list items upon reaccessing the application even though we might have
added some items in the past.</p>
<p>The funny array notation here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">controller</span>(<span style="color:#e6db74">&#39;TodoController&#39;</span>, [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$http&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;windowAlert&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>, <span style="color:#a6e22e">$http</span>, <span style="color:#a6e22e">windowAlert</span>) {
</span></span></code></pre></div><p>is used to specify the dependencies explicitly to avoid minification issues.
Read the <strong>A Note on Minification</strong> section
<a href="http://docs.angularjs.org/tutorial/step_05">here</a>
if you are interested in finding out more. In short, it is <strong>good practice</strong>
to use this array notation to specify dependencies explicitly, be it for
controllers, or other things. In fact, we&rsquo;ve seen one example in the
<strong>AngularJS concept - Routes</strong> section above (for the <code>$routeProvider</code> service).
If you are confused by what is a <strong>dependency</strong> is, the arguments to a
controller are its dependencies.
The more commonly seen dependencies built-in to AngularJS are probably
<code>$scope</code> and <code>$http</code>.
For now, don&rsquo;t worry about what other things can be dependencies.
You will have a much better idea as your AngularJS expertise grows.</p>
<p>We mentioned that controllers are used to augment behavior for the given
<code>$scope</code> object. Observe that in <strong>static/todo.js</strong> that at lines 32, 54 and 69
of <code>TodoController</code>, we have assigned some functions to
<code>$scope.addItem</code>, <code>$scope.retrieveLastNItems</code> and
<code>$scope.setAndRetrieveLastNItems</code> respectively. We shall not dive into their
code for now, but instead move to something more hands on.</p>
<h2 id="adding-a-new-todo-list-item---from-start-to-finish">Adding a new todo list item - from start to finish</h2>
<p><strong>NOTE:</strong> This section is going to jump around a lot of files, but I will
show the relevant section of the file and state the filename and the relevant
line numbers.
I will try to explain to the best of my ability, so stick with me.</p>
<p>Our journey begins from lines 4 to 9 of <strong>static/todo.html</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#a6e22e">ng-submit</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;addItem()&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">fieldset</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Add something&#34;</span> <span style="color:#a6e22e">size</span><span style="color:#f92672">=</span><span style="color:#e6db74">50</span> <span style="color:#a6e22e">ng-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.newItem&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn btn-primary&#34;</span>&gt;Add item&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">fieldset</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;
</span></span></code></pre></div><p>Recall from the earlier sections that this is the template for the route <code>/</code>
and its controller is <code>TodoController</code>, which we covered in the last section.
I would like you to focus on line 6:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Add something&#34;</span> <span style="color:#a6e22e">size</span><span style="color:#f92672">=</span><span style="color:#e6db74">50</span> <span style="color:#a6e22e">ng-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.newItem&#34;</span> /&gt;
</span></span></code></pre></div><p>This is the input field where you type some text to add as a todo list item.
In particular, look at the <code>ng-model=&quot;state.newItem&quot;</code> part. By now, you should
know that <code>ng-model</code> is a directive. In this case, we are creating a <strong>two-way
data binding</strong> between the text contained in the input field and the
<code>$scope.state.newItem</code> variable. When specifying the variable name in the
<code>ng-model</code> directive, we omit the <code>$scope.</code> portion. We did not assign any
value to this variable inside the <code>TodoController</code>, but this is fine.</p>
<p>What we mean by a <strong>two-way data binding</strong> is this: whenever the text inside
the input field changes (such as from the user typing new text or editing the
contents of the input field),
the value of the variable <code>$scope.state.newItem</code> is updated to reflect that
value. That is one direction.
Correspondingly, in the other direction, should the value of the variable
<code>$scope.state.newItem</code> change, the text shown in the input field will be
updated to reflect the change. And that completes both directions.</p>
<p>Now, suppose we enter the following text:</p>
<pre><code>Do laundry
</code></pre>
<p>into the input field. Due to two-way data binding specified by the <code>ng-model</code>
directive, the value of the <code>$scope.state.newItem</code> variable will be updated
to the string <code>&quot;Do laundry&quot;</code>.</p>
<p>Now, turn your attention towards line 4 of the same file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">ng-submit</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;addItem()&#34;</span>&gt;
</span></span></code></pre></div><p>Observe that there is no <code>action</code> or <code>method</code> attribute on the <code>&lt;form&gt;</code> element.
Instead, there is an <code>ng-submit</code> directive. The <code>ng-submit</code> directive will
evaluate an AngularJS expression when we submit the form. The expression
specified in this case is a call to the <code>$scope.addItem</code> function.
Recall that <code>$scope.addItem</code> is assigned a function in <code>TodoController</code>, and
that is where we shall look at next. Go to <strong>static/todo.js</strong>, lines 32 to 52:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#34;text field must be non-empty&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$http</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/todoAdd&#39;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">success</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>(
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>
</span></span><span style="display:flex;"><span>                    );
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#39;Adding of item failed&#39;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">error</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>This function contains a single <code>if</code> statement. We shall carry on with the
assumption that the <code>$scope.state.newItem</code> variable holds the string
<code>&quot;Do laundry&quot;</code> and cover the <code>else</code> case, leaving the <code>then</code> case to a later
section.</p>
<p>Now, we see a single <code>post</code> method call to the <code>$http</code> service. The first
parameter of the <code>post</code> call specifies the url, which is <code>/todoAdd</code>, while
the second parameter specifies the data to send to that url. In this case,
the data is a json object with an item property, whose value is the string
<code>&quot;Do laundry&quot;</code>.</p>
<p>The interesting portion comes after the <code>post</code> method call, where we have
the <code>.success</code> and <code>.error</code> calls. <code>$http.post</code> returns a promise with two
methods, <code>success</code> and <code>error</code>, and each is used to specify a function (with
the four parameters shown) to be called <strong>asynchronously</strong> when the <code>$http.post</code>
finishes, depending on the outcome of the <code>$http.post</code> call. This also means
that the <code>$http.post</code> is an AJAX call.
For those familiar with jQuery, <code>$http.post</code> is very similar to <code>$.post</code>.
There is <code>$http.get</code>, <code>$http.put</code> and other methods as well.</p>
<p>In simple terms, the function specified in the <code>success</code> part will be
called if the <code>$http.post</code> call succeeds, and the function specified in the
<code>error</code> part will be called if the <code>$http.post</code> call fails.
Here, we choose not to do any error handling when the <code>$http.post</code> call
errors out, which is why the function given to the <code>error</code> part has an
empty body.</p>
<p>We mentioned that the <code>$http.post</code> call is asynchronous.
This means that the <code>$http.post</code> call does not block, so if you have any code
after it, they will <strong>very likely</strong> be executed before the proper callback
function for the <code>$http.post</code> call gets executed.</p>
<p>While I am a bit hesitant to write this part about what goes on when the
<code>$http.post</code> call issues a POST request that hits the url, since this is an
AngularJS tutorial, and material here covers Flask. However, I think it will be
beneficial for those seeking to see how things play out on the backend.
It&rsquo;s really standard backend web development stuff.
So if you are not interested, feel free to skip to the
part where I talk about what happens when the <code>$http.post</code> call succeeds
and we return to AngularJS land.</p>
<p>Now, to recap, we are at the stage where the <code>$http.post</code> call sends off
a <strong>POST</strong> request to the url <code>/todoAdd</code>. We are leaving AngularJS and
going off to our Flask backend, at <strong>todo.py</strong>, lines 9 and 10:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>app<span style="color:#f92672">.</span>add_url_rule(<span style="color:#e6db74">&#39;/todoAdd&#39;</span>, view_func<span style="color:#f92672">=</span>TodoAdd<span style="color:#f92672">.</span>as_view(<span style="color:#e6db74">&#39;todo_add&#39;</span>),
</span></span><span style="display:flex;"><span>    methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;POST&#39;</span>])
</span></span></code></pre></div><p>Notice that this endpoint handles the <strong>POST</strong> method exclusively.
Control is passed over to the <code>TodoAdd</code> MethodView, at <strong>todoView.py</strong>,
lines 13 to 17:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TodoAdd</span>(flask<span style="color:#f92672">.</span>views<span style="color:#f92672">.</span>MethodView):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">post</span>(self):
</span></span><span style="display:flex;"><span>        args <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(request<span style="color:#f92672">.</span>data)
</span></span><span style="display:flex;"><span>        TodoModel<span style="color:#f92672">.</span>add_item(args[<span style="color:#e6db74">&#39;item&#39;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> jsonify({ <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span> })
</span></span></code></pre></div><p>I shall not go into the details, but basically, the data sent over by
<code>$http.post</code> is in the <code>request.data</code> variable. We use the built-in <code>json</code>
library&rsquo;s <code>json.loads</code> function to convert the json data to a python dict.
Recall that in <strong>static/todo.js</strong> (lines 36 to 39):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$http</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/todoAdd&#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>
</span></span><span style="display:flex;"><span>    })
</span></span></code></pre></div><p>the <code>$http.post</code> call sends out an object with an <code>item</code> property. Now, at
line 16 of <strong>todoView.py</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>TodoModel<span style="color:#f92672">.</span>add_item(args[<span style="color:#e6db74">&#39;item&#39;</span>])
</span></span></code></pre></div><p>We access the <code>item</code> key of the dict converted from the POST request data,
and pass it to the <code>TodoModel.add_item</code> function, located at lines 11 to 14
of <strong>todoModel.py</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@classmethod</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_item</span>(cls, item):
</span></span><span style="display:flex;"><span>    _cursor<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;INSERT INTO todo(text) VALUES(?)&#39;</span>, (item, ))
</span></span><span style="display:flex;"><span>    _conn<span style="color:#f92672">.</span>commit()
</span></span></code></pre></div><p>The heart of this function is a SQL statement to insert the
item into the &rsquo;text&rsquo; column of the database. We are done with this function.
So we return from this function call and go back to <strong>todoView.py</strong>,
lines 13 to 17:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TodoAdd</span>(flask<span style="color:#f92672">.</span>views<span style="color:#f92672">.</span>MethodView):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">post</span>(self):
</span></span><span style="display:flex;"><span>        args <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(request<span style="color:#f92672">.</span>data)
</span></span><span style="display:flex;"><span>        TodoModel<span style="color:#f92672">.</span>add_item(args[<span style="color:#e6db74">&#39;item&#39;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> jsonify({ <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span> })
</span></span></code></pre></div><p>We have added the new todo list item, so there is only one thing remaining,
the return statement. We return a json object with a single property called
<code>success</code>, its value being <code>True</code>.</p>
<p>Now, we are back to AngularJS land, at <strong>static/todo.js</strong>, lines 36 to 48:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$http</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/todoAdd&#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">success</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#39;Adding of item failed&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span></code></pre></div><p>Since the <code>$http.post</code> call succeeds (a HTTP 200 code is returned), we
execute the success callback function. Recall that the Flask backend returns a
json object with a property <code>success</code> set to <code>true</code>. We pass the <code>if</code> test
and execute the statement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>);
</span></span></code></pre></div><p>Which brings us to lines 54 to 67 of the same <strong>static/todo.js</strong> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">n</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$http</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/todoRetrieve/&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">success</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">todoList</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">todoList</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#39;Retrieval failed&#39;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">error</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#34;Retrieval failed&#34;</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>This is a <code>$http.get</code> call, with the parameter <code>n</code> being
<code>$scope.state.retrieveNr</code>, which is assigned the value
<code>$scope.RETRIEVE_DEFAULT_NR</code> (at line 29 of of the same file,
<strong>static/todo.js</strong>), which is <code>5</code>. Since you are now familiar with
<code>$http.post</code>, <code>$http.get</code> works similarly with regards to the promise and
callbacks, so I shall not go into detail explaining the same concepts again.</p>
<p>I will be going through the Flask portion after the <code>$http.get</code> call. Feel
free to skip this by scrolling down until you see that we have returned
to AngularJS land.</p>
<p>Looking at <strong>todo.py</strong>, lines 11 and 12:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>app<span style="color:#f92672">.</span>add_url_rule(<span style="color:#e6db74">&#39;/todoRetrieve/&lt;int:n&gt;&#39;</span>,
</span></span><span style="display:flex;"><span>    view_func<span style="color:#f92672">=</span>TodoRetrieve<span style="color:#f92672">.</span>as_view(<span style="color:#e6db74">&#39;todo_retrieve&#39;</span>), methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;GET&#39;</span>])
</span></span></code></pre></div><p>There is a MethodView called <code>TodoRetrieve</code> handling the <code>/todoRetrieve</code> url.
It is located at <strong>todoView.py</strong>, lines 19 to 31:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TodoRetrieve</span>(flask<span style="color:#f92672">.</span>views<span style="color:#f92672">.</span>MethodView):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>(self, n):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            n <span style="color:#f92672">=</span> int(n)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span>:
</span></span><span style="display:flex;"><span>            n <span style="color:#f92672">=</span> RETRIEVE_DEFAULT_NR
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> n <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            n <span style="color:#f92672">=</span> RETRIEVE_DEFAULT_NR
</span></span><span style="display:flex;"><span>        todoList <span style="color:#f92672">=</span> TodoModel<span style="color:#f92672">.</span>retrieve_last_N_items(n)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> jsonify({
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;todoList&#39;</span>: [{ <span style="color:#e6db74">&#39;text&#39;</span>: item } <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> todoList]
</span></span><span style="display:flex;"><span>        })
</span></span></code></pre></div><p>Much of the <code>get</code> function is dedicated to ensuring that n is a non-negative
integer. The heart of this function lies in line 27:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>todoList <span style="color:#f92672">=</span> TodoModel<span style="color:#f92672">.</span>retrieve_last_N_items(n)
</span></span></code></pre></div><p>at lines 16 to 21 of <strong>todoModel.py</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@classmethod</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">retrieve_last_N_items</span>(cls, n):
</span></span><span style="display:flex;"><span>    rows <span style="color:#f92672">=</span> _cursor<span style="color:#f92672">.</span>execute(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;SELECT text FROM todo ORDER BY id DESC LIMIT ?&#39;</span>, (n, )
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [r[<span style="color:#e6db74">&#39;text&#39;</span>] <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> rows]
</span></span></code></pre></div><p>Here, we are retrieving the <code>n</code> most recently inserted items, <code>n</code> being 5
in this case.</p>
<p>We go back to <strong>todoView.py</strong>, lines 19 to 31:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TodoRetrieve</span>(flask<span style="color:#f92672">.</span>views<span style="color:#f92672">.</span>MethodView):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>(self, n):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            n <span style="color:#f92672">=</span> int(n)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span>:
</span></span><span style="display:flex;"><span>            n <span style="color:#f92672">=</span> RETRIEVE_DEFAULT_NR
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> n <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            n <span style="color:#f92672">=</span> RETRIEVE_DEFAULT_NR
</span></span><span style="display:flex;"><span>        todoList <span style="color:#f92672">=</span> TodoModel<span style="color:#f92672">.</span>retrieve_last_N_items(n)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> jsonify({
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;success&#39;</span>: <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;todoList&#39;</span>: [{ <span style="color:#e6db74">&#39;text&#39;</span>: item } <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> todoList]
</span></span><span style="display:flex;"><span>        })
</span></span></code></pre></div><p>After the call to <code>TodoModel.retrieve_last_N_items</code>, the <code>get</code> function
returns a json object with 2 properties, <code>success</code> and <code>todoList</code>.
The <code>success</code> property holds the value <code>True</code>, while the <code>todoList</code>
property is an array of objects, each of which with a single <code>text</code>
property containing the text we retrieved from the database.</p>
<p>Now, we return to AngularJS land, lines 54 to 67 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">n</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$http</span>
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/todoRetrieve/&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">success</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">todoList</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">todoList</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#39;Retrieval failed&#39;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">error</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#34;Retrieval failed&#34;</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>This <code>$http.get</code> call is a success, with the json object returned by our
Flask backend available in the <code>data</code> parameter of the callback function
specified in the success call of the promise. Recall that our Flask backend
returned a json object with a <code>success</code> property with value <code>True</code>, so the
<code>if (data.success)</code> test passes. Thus we go to execute the statement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">todoList</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">todoList</span>;
</span></span></code></pre></div><p>Which sets <code>$scope.state.todoList</code> to the <code>todoList</code> property of the object
returned by the Flask backend. This is why we are able to see the todo list
updated with the last recently inserted items everytime we insert a new item.
Yea, I know it&rsquo;s expensive to query the database everytime we add a new item,
but this is just for illustration purposes.</p>
<p>And recall that this call to <code>$scope.retrieveLastNItems</code> originated from the
success callback of the <code>$scope.addItem</code> function in
<strong>static/todo.js</strong> (lines 32 to 52):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#34;text field must be non-empty&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$http</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/todoAdd&#39;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">success</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>(
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>
</span></span><span style="display:flex;"><span>                    );
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#39;Adding of item failed&#39;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">error</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>And there are no more statements after the <code>$scope.retrieveLastNItems</code> call.
So we are done with this branch, and effectively the <code>$http.post</code> call,
and the <code>$scope.addItem</code> call. So we have shown the whole process of adding
a new todo list item, from frontend to backend.</p>
<p>While we have shown how the todo list gets updated within the <code>TodoController</code>,
this does not answer the question - how does it get displayed in a HTML table?
Surely some kind of DOM manipulation is needed.
That is the subject of our next section.</p>
<h2 id="angularjs-concept---ng-repeat">AngularJS concept - ng-repeat</h2>
<p>Open <strong>static/todo.html</strong>, and look at lines 21 to 33:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">table</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;table&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">thead</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">th</span>&gt;Number&lt;/<span style="color:#f92672">th</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">th</span>&gt;Text&lt;/<span style="color:#f92672">th</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">thead</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">tbody</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">tr</span> <span style="color:#a6e22e">ng-repeat</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;item in state.todoList&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">td</span>&gt;{{ $index + 1 }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">td</span>&gt;{{ item.text }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">tbody</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">table</span>&gt;
</span></span></code></pre></div><p>This is where the todo list gets displayed. The interesting part is here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span> <span style="color:#a6e22e">ng-repeat</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;item in state.todoList&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ $index + 1 }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ item.text }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span></code></pre></div><p>Where we see an <code>ng-repeat</code> directive.
The <strong>repeat expression</strong> is <code>item in state.todoList</code>, and specifically, we
are iterating over the <code>$scope.state.todoList</code> array in the <code>TodoController</code>.
This array happens to be the todo list. At each iteration, <code>ng-repeat</code> creates
a new scope and binds the current item of <code>state.todoList</code> to the variable
<code>item</code>. The entire <code>'&lt;tr&gt;'</code> element and everything within it is the <strong>template</strong>
for the <code>ng-repeat</code>, in otherwords, a piece of HTML to be repeated for
each element in <code>$scope.state.todoList</code>.</p>
<p>If that seems like a lot of jargon, it is. I suggest you read it slowly one
more time. But the idea behind <code>ng-repeat</code> is very simple: <code>ng-repeat</code> repeats
the entire HTML block it appears in for each element we are iterating over.</p>
<p>Confused? I will give you a more concrete example.
Suppose <code>$scope.state.todoList</code> has the value</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>[{ <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;go out with friends&#39;</span> }, { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;watch tv&#39;</span> }, { <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Do laundry&#39;</span> }]
</span></span></code></pre></div><p>Then, what we will get is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ $index + 1 }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ item.text }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ $index + 1 }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ item.text }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ $index + 1 }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ item.text }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span></code></pre></div><p>So for the first <code>&lt;tr&gt;</code> element you see here, <code>item</code> refers to the object
<code>{ text: 'go out with friends' }</code>, the 0th element of <code>$scope.state.todoList</code>.
For the second <code>&lt;tr&gt;</code> element, <code>item</code> refers to the object
<code>{ text: 'watch tv' }</code>, the 1th element of <code>$scope.state.todoList</code>.
For the third <code>&lt;tr&gt;</code> element, <code>item</code> refers to the object
<code>{ text: 'Do laundry' }</code>, the 2nd element of <code>$scope.state.todoList</code>.</p>
<p>The <code>$index</code> variable is something unique to <code>ng-repeat</code>. It is the offset of
the element we are iterating over, starting from 0.</p>
<p>Therefore, <code>$index</code> has the value <code>0</code> for the first <code>&lt;tr&gt;</code> element, the value
<code>1</code> for the second <code>&lt;tr&gt;</code> element, and the value <code>2</code> for the final <code>&lt;tr&gt;</code>
element.</p>
<p>Now that we know all that, and you know JavaScript, you can probably infer
that the final result of the <code>ng-repeat</code> will look something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;1&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;go out with friends&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;2&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;watch tv&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;3&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;Do laundry&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span></code></pre></div><p>Tada! Notice how there isn&rsquo;t <strong>any</strong> DOM manipulation, like deleting existing
rows in the table, and updating the table with the new todo list entries by
adding new rows to it representing the updated todo list items.
There is <strong>none</strong> of that. The table just gets updated. It&rsquo;s just like magic.
Ok, we all know it&rsquo;s not magic, but yea.</p>
<p>While you will probably need to do DOM manipulations for more complex
applications, I&rsquo;m pretty sure that the use case we&rsquo;ve just seen is very
common.
In other words, ensuring that what the user sees (the <strong>View</strong>) matches the
application state (the <strong>Model</strong>). And that is our focus for the next
section.</p>
<h2 id="angularjs-concepts---tying-together-the-model-view-controller">AngularJS concepts - tying together the Model, View, Controller</h2>
<p>So far, we have seen quite a bit of AngularJS. Certainly not in terms of
code, but in terms of concepts.</p>
<p>The <strong>Model</strong> refers to the application state, or the various
<code>scope</code> objects.
In AngularJS, these scope objects should be the one and only source of truth
with regards to the application state.</p>
<p>The <strong>View</strong> is what the user sees. An example is the <strong>static/todo.html</strong>
file, which houses the HTML template of our todo list application.</p>
<p>The <strong>Controller</strong> is used to set up initial state (the <strong>Model</strong>) by
modifying the scope object, and augmenting the scope object with additional
behaviour, like what we have done above by adding some functions to the
given <code>$scope</code> object.
You can think of this augmentation as setting up the <strong>business logic</strong>
of your application.</p>
<p>Now, you may see AngularJS referred to as an <strong>MVVM</strong> framework, or
<strong>Model View View Model</strong>. That is correct as well, due to the
<strong>two-way data binding</strong>.
Whenever the Model changes, the View is updated; whenever the View changes,
the Model is updated.
The image below from the AngularJS docs illustrates this concept:</p>
<p><img src="http://docs.angularjs.org/img/Two_Way_Data_Binding.png" alt=""></p>
<p>The glue between Model and View is the <strong>Directive</strong>, the most notable
being <code>ng-model</code> and <code>ng-repeat</code>. Directives are a lot more than that,
but for now this explanation suffices.</p>
<p>Do take a look at the diagram located
<a href="http://docs.angularjs.org/guide/dev_guide.mvc.understanding_view">here</a>.
I hope that this tutorial has helped you to understand at least some of it.
But this is not the end of the tutorial (<strong>evil laugh</strong>)</p>
<p>Now, let&rsquo;s move on to another AngularJS concept - the <strong>Factory</strong>.</p>
<h2 id="angularjs-concept---factories">AngularJS concept - Factories</h2>
<p>Try adding an empty item to the todo list. You should see an alert box:</p>
<p><img src="/images/2013-08-27-ngtut/todolist03.png" alt=""></p>
<p>This is due to lines 32 to 35 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#34;text field must be non-empty&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span></code></pre></div><p>Which causes any falsy value in <code>$scope.state.newItem</code> to fall into that
branch, and call the windowAlert function.</p>
<p>Now, look at lines 21 to 25 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">controller</span>(<span style="color:#e6db74">&#39;TodoController&#39;</span>, [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$http&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;windowAlert&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>, <span style="color:#a6e22e">$http</span>, <span style="color:#a6e22e">windowAlert</span>) {
</span></span></code></pre></div><p>See how we specified <code>windowAlert</code> as a dependency. In the section
titled &ldquo;AngularJS concept - Controller, Model&rdquo;, I mentioned that
<code>windowAlert</code> is a factory that I implemented. In fact, it&rsquo;s right above
the definition for <code>TodoController</code>, at lines 15 to 20 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">factory</span>(<span style="color:#e6db74">&#39;windowAlert&#39;</span>, [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$window&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$window</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">$window</span>.<span style="color:#a6e22e">alert</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>])
</span></span></code></pre></div><p>Here, we are creating a factory called <code>windowAlert</code>. This factory is
dependent on the <code>$window</code> service (built-in to AngularJS).
The actual value of the <code>windowAlert</code> factory is the return value of the
function, which is <code>$window.alert</code>.
This is in fact the JavaScript <code>window.alert</code> method provided through
AngularJS&rsquo; <code>$window</code> service.
The reason we are defining a factory to house <code>$window.alert</code> is
for testing reasons, as we shall see later.</p>
<p>Back to the main topic of this section, a factory is very similar to a
service. You should check out
<a href="http://stackoverflow.com/questions/13762228/confused-about-service-vs-factory/13763886#13763886">this</a>
stack overflow question and
<a href="https://groups.google.com/forum/#!topic/angular/qYBkDDDyEw0">this</a>
link
for explanations better than I can offer with regards to the
difference between factories and services.</p>
<p>But a probably correct (I hope) and tldr explanation is: A factory is a
<strong>singleton</strong> object.</p>
<p>So whenever we see a windowAlert call, such as in lines 32 to 35 of
<strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#34;text field must be non-empty&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span></code></pre></div><p>we can substitute the <code>windowAlert</code> with whatever is returned by the
<code>windowAlert</code> factory function, so it is essentially:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$window</span>.<span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#34;text field must be non-empty&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span></code></pre></div><p>which is why we get the alert box whenever we try to add an empty item.</p>
<h2 id="the-retrieve-buttons">The retrieve buttons</h2>
<p>Now onto the final feature I will be covering, the retrieve buttons.
At lines 11 to 19 of <strong>static/todo.html</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn&#34;</span> <span style="color:#a6e22e">ng-click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;setAndRetrieveLastNItems(5)&#34;</span>&gt;
</span></span><span style="display:flex;"><span>Retrieve last 5 items
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn&#34;</span> <span style="color:#a6e22e">ng-click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;setAndRetrieveLastNItems(10)&#34;</span>&gt;
</span></span><span style="display:flex;"><span>Retrieve last 10 items
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;btn&#34;</span> <span style="color:#a6e22e">ng-click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;setAndRetrieveLastNItems(15)&#34;</span>&gt;
</span></span><span style="display:flex;"><span>Retrieve last 15 items
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">button</span>&gt;
</span></span></code></pre></div><p>We see the template for the buttons. Focus on the <code>ng-click</code> directive.
Suppose we click on the &ldquo;Retrieve last 15 items&rdquo; button.
This will result in a call to the <code>$scope.setAndRetrieveLastNItems</code> function
defined at lines 69 to 72 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">setAndRetrieveLastNItems</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">n</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>);
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>with the argument <code>n</code> set to the value <code>15</code>.
The scope variable <code>$scope.state.retrieveNr</code> is modified to <code>15</code>, and
the <code>$scope.retrieveLastNItems</code> is called. Because we have gone through
the flow of the <code>$scope.retrieveLastNItems</code> function above, we shall not
do it here. In this case, it retrieves the last 15 inserted todo list items
from the database and updates the todo list with those items.</p>
<p>And we are done in terms of features of the application!<!-- raw HTML omitted --><!-- raw HTML omitted -->6<!-- raw HTML omitted --><!-- raw HTML omitted -->
Give yourself a pat on the back for having come so far!</p>
<p>You might want to familiarize yourself with what we have covered so far
before moving on.</p>
<p>Next, we move on to something I personally find very important - testing.</p>
<h2 id="angularjs-testing---setting-up">AngularJS Testing - setting up</h2>
<p>There are many JavaScript testing frameworks and test runners, but AngularJS
works very well with <strong>Karma</strong>. In fact, that is the test runner used in
the official AngularJS tutorial.</p>
<p>To use Karma, you will have to install <strong>node.js</strong>. I&rsquo;ve tested this with
node.js <strong>v0.10.15</strong>, and I believe a reasonably modern version of node.js
should work fine.</p>
<p>The version of <strong>Karma</strong> I&rsquo;m using is <strong>v0.10.2</strong>.
Once you have installed node.js, install karma globally by:</p>
<pre><code>npm -g install karma@0.10.2
</code></pre>
<p>We will also need a browser to capture the output from Karma. For this, I
personally prefer <strong>PhantomJS</strong>. You can also use Firefox, Chrome, or any
other <strong>modern</strong> browser, but you will have to edit the Karma configuration
file.</p>
<p>The version of <strong>PhantomJS</strong> that I&rsquo;ve worked with is <strong>v1.9.1</strong>.
You will have to install it globally:</p>
<pre><code>npm -g install phantomjs@1.9.1
</code></pre>
<p>And we are done with the software needed for running the tests.
Let us take a look at the Karma configuration file.</p>
<h2 id="angularjs-testing---the-karma-configuration-file">AngularJS Testing - the Karma configuration file</h2>
<p>Now because the Karma configuration file is pretty long, I shall not paste
it in its entirety. Instead, I will go through it part by part. The file
is located at <strong>test/test.conf.js</strong>.</p>
<p>Look at lines 7 and 8 of <strong>test/test.conf.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// base path, that will be used to resolve files and exclude
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">basePath</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;..&#39;</span>,
</span></span></code></pre></div><p>This specifies the path where Karma starts looking for files,
<strong>relative to the directory the test/test.conf.js file is located in</strong>.
For convenience reasons, we set it to <code>'..'</code>, or one directory above
the <strong>test</strong> folder. That happens to be the root of the repository.
We shall see why later.</p>
<p>Now, look at line 10 of <strong>test/test.conf.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">hostname</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;127.0.0.1&#39;</span>,
</span></span></code></pre></div><p>This specifies the server where browsers will capture output from running
the tests. You will be running the tests on your own machine, hence the
localhost IP address. I&rsquo;ve used <code>127.0.0.1</code> instead of <code>localhost</code> in case
you have configured <code>localhost</code> to something else in <code>/etc/hosts</code>.</p>
<p>Moving on to lines 13 and 14 of <strong>test/test.conf.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// frameworks to use
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">frameworks</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;jasmine&#39;</span>],
</span></span></code></pre></div><p>We see that <strong>jasmine</strong> is specified as a test framework to use.
Notice how we said Karma is a <strong>test runner</strong>. It is used to run tests.
There is a nice test framework called <strong>jasmine</strong> that comes with Karma,
so we will be using that.</p>
<p>On to lines 17 to 24 of <strong>test/test.conf.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// list of files / patterns to load in the browser
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">files</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;test/lib/jquery-1.10.2.min.js&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;test/lib/angular.min.js&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;test/lib/angular-mocks.js&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;static/todo.js&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;test/**/*.spec.js&#39;</span>
</span></span><span style="display:flex;"><span>],
</span></span></code></pre></div><p>Here, we specify a list of files to be loaded. This includes all the
files for the actual test cases and any file they require. You can use
wildcard patterns such as &lsquo;*&rsquo; and &lsquo;**&rsquo;. I shall not go into their details.
Only the line:</p>
<pre><code>test/**/*.spec.js
</code></pre>
<p>includes the actual test cases. In fact, the test cases are located at
the <strong>test/unit</strong> folder, and end with the extension &lsquo;.spec.js&rsquo;.</p>
<p>Notice the order in which we specify the files to be loaded.
The order matters.
In an earlier section, we said that if we are using jQuery, we will have
to include it before the AngularJS library. The same applies here.</p>
<p>There is an <strong>angular-mocks.js</strong> file after the angular.min.js file.
That is a mock library that we <strong>must</strong> include for our AngularJS tests.
If you need it for your future work, you can find it at the
<strong>angular-seed</strong> <a href="https://github.com/angular/angular-seed">repository</a>,
specifically <a href="https://github.com/angular/angular-seed/tree/master/test/lib/angular">here</a>.</p>
<p>After that, we specify all the AngularJS files that we have written and require.
In this case, we only have one, <strong>static/todo.js</strong>.</p>
<p>Finally, we include our test files using the wildcard pattern
<code>test/**/*.spec.js</code>.</p>
<p>Two observations.</p>
<ol>
<li>
<p>Notice all the paths here are relative to the root of the repository.
This is due to us specifying the <code>basePath</code> property to be <code>'..'</code> above.
If the basepath was set to the <code>test</code> folder, we will have to
write <code>../test/lib/jquery-1.10.2.min.js</code>, <code>../static/todo.js</code>, and so on.</p>
</li>
<li>
<p>Those with a <strong>very</strong> good memory will recall that our application uses CDNs
for the JavaScript files.
Open <strong>templates/layout.html</strong> and look at lines 3 to 6:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p>When running the tests, the libraries required by the AngularJS code we are
testing need to be on our local filesystem. Do take note of this if you are
using some kind of CDN, or if the libraries you are using are not inside your
repository.</p>
<p>I will skip the <code>exclude</code> and <code>reporters</code> properties and move on to
lines 37 and 38 of <strong>test/test.conf.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// web server port
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">9876</span>,
</span></span></code></pre></div><p>This is the port where the Karma will be running. Change it to another port
if you have something else running on it.</p>
<p>I&rsquo;m going to skip over the <code>colors</code>, <code>loglevel</code> and <code>autoWatch</code> properties
and move on to lines 54 to 62 of <strong>test/test.conf.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Start these browsers, currently available:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Chrome
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - ChromeCanary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Firefox
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Opera
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Safari (only Mac)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - PhantomJS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - IE (only Windows)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">browsers</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;PhantomJS&#39;</span>],
</span></span></code></pre></div><p>Earlier, I mentioned that you can use another browser than PhantomJS, but
you will have to edit the configuration file.
This is the section where you have to edit.
Suppose you want to use Firefox instead of PhantomJS. So you will edit
the browsers property to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">browsers</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;Firefox&#39;</span>],
</span></span></code></pre></div><p>Next, moving on to lines 69 to 71 of <strong>test/test.conf.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Continuous Integration mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// if true, it capture browsers, run tests and exit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">singleRun</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>The <code>singleRun</code> option determines if the tests are just run once or
continuously (until you tell Karma to stop).
Here, we choose to run it once, so after running the tests, Karma exits.</p>
<p>Earlier, I skipped the <code>autoWatch</code> option, at lines 50 to 51:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// enable / disable watching file and executing tests whenever any file changes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">autoWatch</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span></code></pre></div><p>The <code>autoWatch</code> property, if set to <code>true</code>, will monitor the files listed
inside the <code>files</code> array for changes.
<code>autoWatch: true</code> combined with the <code>singleRun: false</code> will continuously
monitor the <code>files</code> array for changes and run the tests upon any change.</p>
<p>In case you are curious, I did not write this configuration file from scratch.
The initial configuration file is generated using <code>karma init</code>.</p>
<h2 id="running-the-tests">Running the tests</h2>
<p>Before we move on with the explanation of the test cases, I think it will be
good for you to see that the tests are working. Be sure to have installed the
required software as outlined in the &ldquo;<strong>AngularJS Testing - setting up</strong>&rdquo;
section above.</p>
<p>To run the tests from the root of the repository:</p>
<pre><code>karma start test/test.conf.js
</code></pre>
<p>You should see something like this:</p>
<p><img src="/images/2013-08-27-ngtut/ngtut04.png" alt=""></p>
<p>Alternatively, you can run the tests in the <code>test</code> folder:</p>
<pre><code>cd test
karma start test.conf.js
</code></pre>
<p>If you are unable to run the test cases for some reason and you are using a
different version for some piece of software, I highly recommend that you
use the versions that I&rsquo;ve used, as stated above.</p>
<h2 id="on-jasmine">On Jasmine</h2>
<p>Because we are using Jasmine as a test framework, there will be some
Jasmine conventions that you have to understand. Here is a
<a href="http://pivotal.github.io/jasmine/">link</a> to a short and sweet Jasmine tutorial.
Do read it so you are more familiar with Jasmine before moving on to the next
section, because I will assume some basic familiarity with Jasmine and talk
more about the stuff specific to AngularJS testing.</p>
<h2 id="a-note-on-the-testing-sections">A note on the Testing sections</h2>
<p>While I know how to write tests for AngularJS applications and I certainly
do think that I know a thing or two about testing AngularJS apps,
I do not know this area as well as the non-testing portion.
There are many things which I will not be able to explain,
because I do not have a good working knowledge of their internals.</p>
<p>In particular, the sections below will contain much fewer explanations than
the ones above and may seem very <strong>hand-wavy</strong> at times.
This is deliberate. It does not mean that I am lazy, but that I simply do
not know enough to explain the information in detail without misleading
you and providing you with wrong information.</p>
<p>If you happen to be an AngularJS pro and know a lot about AngularJS testing
(what are the chances of such a person reading this tutorial),
please write a better tutorial on AngularJS testing than this one.
I am sure <strong>a lot</strong> of people will be very grateful to you, and you will be
doing a great thing.</p>
<p>If you are just starting out in AngularJS and become really good at it one day,
consider doing a good deed by writing a really good tutorial on AngularJS
testing. That will be the best way to contribute back to the community.</p>
<p>Regardless, I believe that you will be able to get a much better idea of
testing AngularJS code after reading the sections below.</p>
<h2 id="testing-the-todocontroller">Testing the TodoController</h2>
<p>Open up <strong>test/unit/TodoController.spec.js</strong>, and look at lines 1 to 10:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;TodoController&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">$scope</span>
</span></span><span style="display:flex;"><span>      , <span style="color:#a6e22e">$httpBackend</span>
</span></span><span style="display:flex;"><span>      , <span style="color:#a6e22e">ctrl</span>
</span></span><span style="display:flex;"><span>      , <span style="color:#a6e22e">windowAlert</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">beforeEach</span>(<span style="color:#a6e22e">module</span>(<span style="color:#e6db74">&#39;TodoApp&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$provide</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">windowAlert</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">jasmine</span>.<span style="color:#a6e22e">createSpy</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$provide</span>.<span style="color:#a6e22e">value</span>(<span style="color:#e6db74">&#39;windowAlert&#39;</span>, <span style="color:#a6e22e">windowAlert</span>);
</span></span><span style="display:flex;"><span>    }));
</span></span></code></pre></div><p>Every Jasmine test suite starts with a <code>describe</code> function. <code>describe</code>s can be
nested. You can have multiple top level <code>describe</code>s. The first argument to
<code>describe</code> is a string describing the test suite. Here, we supply the string
<code>&quot;TodoController&quot;</code>, since this test suite is for testing the <code>TodoController</code>.</p>
<p>The second argument to <code>describe</code> is a function.
There are 5 main types of &ldquo;things&rdquo; within the function:</p>
<ol>
<li>variable declarations</li>
<li><code>beforeEach</code> functions</li>
<li><code>afterEach</code> functions</li>
<li>nested <code>describe</code> functions</li>
<li><code>it</code> functions</li>
</ol>
<p>We see 4 variable declarations from lines 2 to 5.</p>
<p>Within the outermost <code>describe</code>,
there are 2 top level <code>beforeEach</code> functions at lines 7 and 12;
one top level <code>afterEach</code> function at line 18;
one top level <code>it</code> function at line 23;
three top level <code>describe</code> functions at lines 29, 99, 150.</p>
<h2 id="angularjs-testing-concept---initializing-the-module">AngularJS Testing concept - initializing the module</h2>
<p>Let&rsquo;s look at the first <code>describe</code> block at lines 7 to 10:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">beforeEach</span>(<span style="color:#a6e22e">module</span>(<span style="color:#e6db74">&#39;TodoApp&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$provide</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">windowAlert</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">jasmine</span>.<span style="color:#a6e22e">createSpy</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$provide</span>.<span style="color:#a6e22e">value</span>(<span style="color:#e6db74">&#39;windowAlert&#39;</span>, <span style="color:#a6e22e">windowAlert</span>);
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><p>For AngularJS tests, be sure to include a <code>beforeEach</code> function inside each
top level <code>describe</code> to tell it which module you are trying to test.
I cannot stress this further. There was once when I was writing a test case
and it mysteriously failed. Everything looks fine to me, and I&rsquo;ve tried
almost every trick in the book.
It was only after many minutes of looking until I realized I forgot to include
such a <code>beforeEach</code> block with the <code>module</code> function.</p>
<p>Here, we are saying we want to load the <code>TodoApp</code> module.
The second argument is a function, and it is optional.
But if provided, it should have a <code>$provide</code> parameter. Here, we create a mock
using <code>jasmine.createSpy</code>, then mock out the actual <code>windowAlert</code> factory
using that mock by calling the <code>$provide.value</code> function, supplying the
name of what we want to mock out (<code>'windowAlert'</code>), and the mock (the
<code>windowAlert</code> variable).</p>
<p>Let&rsquo;s look at the second <code>beforeEach</code> block, at lines 12 to 16 of
<strong>test/unit/TodoController.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">beforeEach</span>(<span style="color:#a6e22e">inject</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">_$httpBackend_</span>, <span style="color:#a6e22e">$rootScope</span>, <span style="color:#a6e22e">$controller</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$httpBackend</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_$httpBackend_</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$rootScope</span>.<span style="color:#a6e22e">$new</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ctrl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$controller</span>(<span style="color:#e6db74">&#39;TodoController&#39;</span>, { <span style="color:#a6e22e">$scope</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$scope</span> });
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><p>(This is one of those really hand-wavy sections, apologies).</p>
<p>Here, we are injecting some services. Namely, the <code>$httpBackend</code>,
<code>$rootScope</code> and <code>$controller</code> services.</p>
<p>The <code>$rootScope</code> service is used to create new <code>scope</code> objects using the
<code>$rootScope.$new</code> method, as we are doing in line 14.</p>
<p>The <code>$controller</code> service is used to create new controllers. The first
argument is the name of the controller, and the second argument is an
object which contains a <code>$scope</code> property, whose value is a newly created
scope object.</p>
<p>At line 13, we see</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$httpBackend</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_$httpBackend_</span>;
</span></span></code></pre></div><p>Notice that at line 3, we have declared the <code>$httpBackend</code> variable.
The underscores in <code>_$httpBackend_</code> parameter are used to name
<code>$httpBackend</code> under a different name so we can assign it to a variable of the
same name. For a more detailed explanation, see
<a href="http://stackoverflow.com/questions/15318096/what-does-the-underscores-in-servicename-mean-in-angularjs-tests">this</a>
stack overflow question.</p>
<p>The <code>$httpBackend</code> service is made available through the angular-mock
library. It is used to mock out a backend, as we shall see soon.</p>
<h2 id="first-test-case">First test case</h2>
<p>For Jasmine, actual test cases are the <code>it</code> blocks.
Let&rsquo;s look at our first actual test case, on lines 23 to 27 of
<strong>test/unit/TodoController.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;initialization sets up the scope variables&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>).<span style="color:#a6e22e">toEqual</span>(<span style="color:#a6e22e">jasmine</span>.<span style="color:#a6e22e">any</span>(Object));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">todoList</span>).<span style="color:#a6e22e">toEqual</span>([]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">RETRIEVE_DEFAULT_NR</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Here, we are ensuring that the <code>TodoController</code> is setting up the initial
state properly. Recall that we have created one <code>TodoController</code> in the
<code>beforeEach</code> block with an <code>inject</code>. That controller is available through
the <code>ctrl</code> variable, even though we won&rsquo;t need it in this case.</p>
<p>Looking at the relevant part of <code>TodoController</code> that we are testing,
that is lines 21 to 30 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">controller</span>(<span style="color:#e6db74">&#39;TodoController&#39;</span>, [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$http&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;windowAlert&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>, <span style="color:#a6e22e">$http</span>, <span style="color:#a6e22e">windowAlert</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">RETRIEVE_DEFAULT_NR</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">todoList</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">RETRIEVE_DEFAULT_NR</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">pageName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;todoList&#39;</span>;
</span></span></code></pre></div><p>We see that this line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>).<span style="color:#a6e22e">toEqual</span>(<span style="color:#a6e22e">jasmine</span>.<span style="color:#a6e22e">any</span>(Object));
</span></span></code></pre></div><p>contains a single <strong>assertion</strong>, given by the <code>expect</code>.
We are asserting that when the <code>TodoController</code> code has finished running,
the <code>$scope.state</code> variable is an object. In this case, we do not care
about the contents of the object, hence we use <code>jasmine.any(Object)</code>, which
is a way of saying we do not care what the actual value of <code>$scope.state</code> is,
as long as it is some object. There is <code>jasmine.any(Number)</code>,
<code>jasmine.any(Function)</code>, etc, and I believe it works for any JavaScript type.</p>
<p>Now, the second assertion in that <code>it</code> block (line 25 of
<strong>test/unit/TodoController.spec.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">todoList</span>).<span style="color:#a6e22e">toEqual</span>([]);
</span></span></code></pre></div><p>We are asserting that <code>$scope.state.todoList</code> is initially an empty array.</p>
<p>Finally, the third and last assertion in the <code>it block</code> (line 26 of
<strong>test/unit/TodoController.spec.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">RETRIEVE_DEFAULT_NR</span>);
</span></span></code></pre></div><p>We are asserting that <code>$scope.state.retrieveNr</code> has the same value as
<code>$scope.RETRIEVE_DEFAULT_NR</code>.</p>
<p>Simple, right? That&rsquo;s why you should write more tests.</p>
<h2 id="a-note-on-tobe-and-toequal">A note on toBe and toEqual</h2>
<p>In general, <code>toBe</code> is used for comparing non object values, such as integers,
strings, booleans. <code>toEqual</code> is used for comparing arrays, objects and the like.</p>
<h2 id="todocontrolleradditem---tests">TodoController::addItem - tests</h2>
<p>Now, let&rsquo;s move on to our second test case, lines 29 to 38 of
<strong>test/unit/TodoController.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;addItem&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemToAdd</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;should not be able to add undefined item&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">windowAlert</span>.<span style="color:#a6e22e">calls</span>.<span style="color:#a6e22e">length</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">windowAlert</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">toBe</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;text field must be non-empty&#39;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    });
</span></span></code></pre></div><p>This time, the <code>it</code> block we are interested in is located within a nested
<code>describe</code> block. We can see that we are trying to test the <code>addItem</code>
function.</p>
<p>Initially, we set <code>$scope.state.newItem</code> to be undefined, and proceed to
call the <code>$scope.addItem</code> function. Looking at the code for that function
(lines 32 to 52, <strong>static/todo.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#34;text field must be non-empty&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$http</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/todoAdd&#39;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">success</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>(
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>
</span></span><span style="display:flex;"><span>                    );
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#39;Adding of item failed&#39;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">error</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>It is not hard to see that we will end up inside the <code>then</code> part of the
outermost <code>if</code> statement, considering that <code>undefined</code> is a falsy<!-- raw HTML omitted --><!-- raw HTML omitted -->7<!-- raw HTML omitted --><!-- raw HTML omitted -->
value. So there should be a <code>windowAlert</code> call.</p>
<p>Let&rsquo;s look at the relevant part of the <code>it</code> block that tests for the
<code>windowAlert</code> call (lines 34 to 37, <strong>test/unit/TodoController.spec.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">windowAlert</span>.<span style="color:#a6e22e">calls</span>.<span style="color:#a6e22e">length</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">windowAlert</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">toBe</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;text field must be non-empty&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>On line 34, we are asserting that the <code>windowAlert</code> factory should only be
called <code>1</code> time.</p>
<p>Lines 35 to 37 check that the first argument (<code>args[0]</code>) of the first call
(<code>calls[0]</code>) to the <code>windowAlert</code> factory is the string
<code>'text field must be non-empty'</code>.</p>
<p>A similar way to check for the argument is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">windowAlert</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">args</span>).<span style="color:#a6e22e">toEqual</span>([<span style="color:#e6db74">&#39;text field must be non-empty&#39;</span>]);
</span></span></code></pre></div><p>Which tests the entire <strong>argument list</strong> of the first call to <code>windowAlert</code>
instead of just the first argument.</p>
<p>Yet another way to write the assertion is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">windowAlert</span>).<span style="color:#a6e22e">toHaveBeenCalledWith</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;text field must be non-empty&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>However, the <code>toHaveBeenCalledWith</code> matcher will pass if there is <strong>any</strong>
call to the function with the given argument list. In this case, there
is only one call to <code>windowAlert</code>, so using <code>toHaveBeenCalledWith</code> is fine.
In general, it is probably safer to use the first two ways.</p>
<p>So why are we able to carry out those assertions on <code>windowAlert</code>, if it is
a JavaScript function?
Recall that at lines 7 to 10 of <strong>test/unit/TodoController.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">beforeEach</span>(<span style="color:#a6e22e">module</span>(<span style="color:#e6db74">&#39;TodoApp&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$provide</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">windowAlert</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">jasmine</span>.<span style="color:#a6e22e">createSpy</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$provide</span>.<span style="color:#a6e22e">value</span>(<span style="color:#e6db74">&#39;windowAlert&#39;</span>, <span style="color:#a6e22e">windowAlert</span>);
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><p>we mocked out the <code>windowAlert</code> factory using a jasmine spy. This <code>windowAlert</code>
variable is declared in line 5.
Therefore, we are not actually calling the real <code>windowAlert</code>, but a jasmine
spy we put in place of it. The ease which we are able to mock out factories
and services such as <code>windowAlert</code> for testing purposes is one powerful
feature of AngularJS.</p>
<p>Yet another observation. Have you noticed that the <code>beforeEach</code> blocks in the
outermost <code>describe</code> block are executed even though the <code>it</code> block we are
looking at is within an inner <code>describe</code> block? That is how Jasmine works.
The <code>beforeEach</code> blocks are executed in order for every <code>it</code> block, from the
ones located in the outermost <code>describe</code> block to the <code>describe</code> block housing
that particular <code>it</code> block, before the code inside the <code>it</code> block is
executed. There is also <code>afterEach</code>, which executes in the reverse order
of <code>beforeEach</code>, but after the <code>it</code> block finishes running.</p>
<p>With what we have just covered, you should be able to understand the <code>it</code>
block located at lines 39 to 46 of <strong>test/unit/TodoController.spec.js</strong>
on your own. It is very similar to the <code>it</code> block we just covered.</p>
<h2 id="a-test-using-httpbackend">A test using $httpBackend</h2>
<p>Now, look at lines 47 to 74 of <strong>test/unit/TodoController.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;add non-empty item&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">postUrl</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">beforeEach</span>(<span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">postUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/todoAdd&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// mock out call to retrieveLastNItems
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">jasmine</span>.<span style="color:#a6e22e">createSpy</span>();
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;on success&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemToAdd</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">beforeEach</span>(<span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">itemToAdd</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;do my laundry&#39;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">$httpBackend</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">expectPOST</span>(<span style="color:#a6e22e">postUrl</span>, {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">itemToAdd</span>
</span></span><span style="display:flex;"><span>                })
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">respond</span>(<span style="color:#ae81ff">200</span>, { <span style="color:#a6e22e">success</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> });
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;should call retrieveLastNItems&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">itemToAdd</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// $httpBackend.flush() required here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">$httpBackend</span>.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>.<span style="color:#a6e22e">calls</span>.<span style="color:#a6e22e">length</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">toBe</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">RETRIEVE_DEFAULT_NR</span>
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    });
</span></span></code></pre></div><p>Most of the code should be familiar to you. Notice that the <code>it</code> block we
are interested in is nested within two <code>describe</code> blocks (not counting the
outermost <code>describe</code> block where the outermost <code>describe</code> block shown
here is located).</p>
<p>Notice that at line 52:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">jasmine</span>.<span style="color:#a6e22e">createSpy</span>();
</span></span></code></pre></div><p>We are mocking out a <code>TodoController</code> function. This is possible because we
have already initialized the <code>TodoController</code> in a <code>beforeEach</code> block located
outside of this <code>describe</code> block, at line 15.</p>
<p>At lines 64 to 66:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;should call retrieveLastNItems&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">itemToAdd</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span>();
</span></span></code></pre></div><p>We are simulating the user typing into the input field and adding a new
todo list item. Looking at the relevant portion of the <code>TodoController</code> code
(lines 32 to 52, <strong>static/todo.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#34;text field must be non-empty&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$http</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/todoAdd&#39;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">success</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>(
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>
</span></span><span style="display:flex;"><span>                    );
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#39;Adding of item failed&#39;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">error</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>We see that the outermost <code>if</code> fails, so we move on to the <code>$http.post</code> part.
Are we actually going to start up our backend for this POST request? No.
This is a unit test, not an end to end test. We will be making use of the
<code>$httpBackend</code> service here.</p>
<p>Look at lines 54 to 63 of <strong>test/unit/TodoController.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;on success&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemToAdd</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">beforeEach</span>(<span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">itemToAdd</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;do my laundry&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$httpBackend</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">expectPOST</span>(<span style="color:#a6e22e">postUrl</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">itemToAdd</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">respond</span>(<span style="color:#ae81ff">200</span>, { <span style="color:#a6e22e">success</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> });
</span></span><span style="display:flex;"><span>    });
</span></span></code></pre></div><p>We see a <code>$httpBackend.expectPOST</code> call. That works exactly like what its
name says, that we are expecting a POST call to our backend.
The first argument is the url, at line 50:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">postUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/todoAdd&#39;</span>;
</span></span></code></pre></div><p>which is set to the string <code>'todoAdd'</code>, which is exactly
the url provided in the <code>$http.post</code> in the <code>$scope.addItem</code> function.</p>
<p>The second argument is the data the POST request should contain.
In this case, it is an object with one property named <code>item</code> with value
<code>do my laundry</code>. Looking at lines 64 to 66 of the <code>it</code> block:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;should call retrieveLastNItems&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">itemToAdd</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span>();
</span></span></code></pre></div><p>the todo list item to be added is exactly that same variable, which has the
same value.</p>
<p>Now, recall that our backend returns a HTTP code and a JSON object upon
success.
If we look at line 62:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$httpBackend</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">expectPOST</span>(<span style="color:#a6e22e">postUrl</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">item</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">itemToAdd</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">respond</span>(<span style="color:#ae81ff">200</span>, { <span style="color:#a6e22e">success</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> });
</span></span></code></pre></div><p>We see a <code>.respond(200, { success: true })</code> call. That is a call to the
object returned by <code>$httpBackend.expectPOST</code>, with the first argument being
the HTTP code (<code>200</code> in this case), and the second argument being the
object it should return, should it encounter the expected POST request.</p>
<p>Going back to our <code>it block</code> at lines 64 to 73 of
<strong>test/unit/TodoController.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;should call retrieveLastNItems&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">newItem</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">itemToAdd</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">addItem</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// $httpBackend.flush() required here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$httpBackend</span>.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>.<span style="color:#a6e22e">calls</span>.<span style="color:#a6e22e">length</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">toBe</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">RETRIEVE_DEFAULT_NR</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>See the <code>$httpBackend.flush()</code>? Prior to calling <code>$httpBackend.flush()</code>,
the <code>$httpBackend</code> will not respond to any calls to the <code>$http</code> service.
This just tells the <code>$httpBackend</code> to go on and respond to those calls.</p>
<p>Let&rsquo;s take a look at the success callback of the <code>$http.post</code> call in the
<code>$scope.addItem</code> function, lines 40 to 48 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">success</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">headers</span>, <span style="color:#a6e22e">config</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">retrieveNr</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">windowAlert</span>(<span style="color:#e6db74">&#39;Adding of item failed&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>Since our <code>$httpBackend</code> returns HTTP code 200 and an object with
property success set to <code>true</code>, we should end up calling the
<code>$scope.retrieveLastNItems</code> function with argument <code>$scope.state.retrieveNr</code>.</p>
<p>But recall that in lines 49 to 53 of <strong>test/unit/TodoController.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">beforeEach</span>(<span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">postUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/todoAdd&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// mock out call to retrieveLastNItems
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">jasmine</span>.<span style="color:#a6e22e">createSpy</span>();
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>we have mocked out the <code>$scope.retrieveLastNItems</code> function with a
jasmine spy. Therefore, we will not be calling the actual
<code>$scope.retrieveLastNItems</code> function.</p>
<p>And at the remaining part of the <code>it</code> block at lines 68 to 72 of
<strong>test/unit/TodoController.spec.js</strong>, we assert some facts about the
spy:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$httpBackend</span>.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>.<span style="color:#a6e22e">calls</span>.<span style="color:#a6e22e">length</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">retrieveLastNItems</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">toBe</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">RETRIEVE_DEFAULT_NR</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>So why do we mock out the call to <code>$scope.retrieveLastNItems</code> instead of
calling the actual function? Well, because:</p>
<ol>
<li>We have a separate test suite for it from lines 99 to 148 of
<strong>test/unit/TodoController.spec.js</strong></li>
<li>It is actually quite a bit of work to test that function. In particular,
we will need to set up a <code>$httpBackend.get</code>, and there are 3 possible
outcomes for the call to <code>$scope.retrieveLastNItems</code>. So that means 3 extra
test cases.</li>
<li>I am being really lazy here. But look at point 1. We already have a
separate test for that function. There is really no reason we should test
that function here again. So checking that it actually gets called (rather,
that the spy gets called) is sufficient.</li>
</ol>
<p>As an extended exercise, see if you can understand the tests in
<strong>test/unit/TodoController.spec.js</strong> that I did not cover here.
You have learnt all the concepts required to understand them.</p>
<h2 id="optional---a-custom-directive">Optional - A custom directive</h2>
<p>This section and the ones below cover slightly more advanced material that
you may to cover on a future reading. Feel free to <!-- raw HTML omitted -->skip<!-- raw HTML omitted -->
to the conclusion below.</p>
<p>If you wish to continue, brace yourself for a tough ride.</p>
<p>Directives are one of the most powerful features of AngularJS.
To convince yourself of this, just look at our earlier examples covering the
built-in AngularJS directives <code>ng-model</code> and <code>ng-repeat</code>.
They are very easy to use and do things that one will consider difficult if
one has to implement them by hand.</p>
<p>In fact, looking at this example at lines 27 to 30 of <strong>static/todo.html</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tr</span> <span style="color:#a6e22e">ng-repeat</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;item in state.todoList&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ $index + 1 }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">td</span>&gt;{{ item.text }}&lt;/<span style="color:#f92672">td</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span></code></pre></div><p>It would seem that we are not writing pure HTML at all, but a mix of HTML and
JavaScript, with this weird brackety syntax for interpolating variables.
This piece of code does a few things that you will have to implement if
you are not using AngularJS:</p>
<ol>
<li>Upon a change to the todo list, remove all the <code>&lt;tr&gt;</code> in the <code>&lt;table&gt;</code>.</li>
<li>After removing all the existing rows of the table, create a new <code>&lt;tr&gt;</code> for
each item in the todo list and insert it into the <code>&lt;table&gt;</code>.</li>
</ol>
<p>Well, if you are a seasoned JavaScript programmer, that is probably not too
difficult to you. However, do you see <strong>any</strong> kind of DOM manipulation here
or anywhere else in the code that allows us to achieve this?
Is there any code that delete rows from or insert rows into the table? No.
All that is taken care of by the <code>ng-repeat</code> directive and the other
underlying mechanisms provided by AngularJS.</p>
<p>While our description of the code looking like a mish mash of HTML and
JavaScript is not wrong, that does not adequately describe how we <strong>feel</strong>
when we write it.
It feels as if we are writing not in HTML or JavaScript, but some other
language, one which offers us greater abstractions and stands at a higher
level, one more suited for our needs.
In other words, a <strong>domain specific language</strong>, or <strong>DSL</strong> in short.
And that is what directives are.</p>
<p>After all that talk, let us look at a real example of a directive.
Its functionality is <strong>very</strong> simple, so I hope it doesn&rsquo;t disappoint you.</p>
<p>Notice the tabs at the top of the todo list application:</p>
<p><img src="/images/2013-08-27-ngtut/todolist01.png" alt=""></p>
<p>And on the second page:</p>
<p><img src="/images/2013-08-27-ngtut/ngtut05.png" alt=""></p>
<p>Observe how the active tab is set to the correct tab whenever we change to
a different page (the active tab is the one whose text is in black color).
This is done through the use of a directive.
So now you might be thinking, ok, this is nothing special.
Yea indeed I don&rsquo;t think it&rsquo;s anything too special as well.
That said, the code to generate this tab in the todo list template, it&rsquo;s
just <strong>one line</strong>.
In fact, it&rsquo;s the first line of the <strong>static/todo.html</strong> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">navtabs</span> <span style="color:#a6e22e">page-name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.pageName&#34;</span>&gt;&lt;/<span style="color:#f92672">navtabs</span>&gt;
</span></span></code></pre></div><p>And for the second page, it is one line as well, at the first line of
<strong>static/secondPage.html</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">navtabs</span> <span style="color:#a6e22e">page-name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.pageName&#34;</span>&gt;&lt;/<span style="color:#f92672">navtabs</span>&gt;
</span></span></code></pre></div><p>Ok, hopefully the fact that it is just one line should catch your attention.
Of course the implementation is more than one line, but to use it in a view,
it really is just this one line. And the fact that we are using this
weird tag named <code>navtabs</code> which is not a real HTML tag should capture even
more of your attention. Right now, there should be one thought in your head
that goes like this - what the hell is going on?<!-- raw HTML omitted --><!-- raw HTML omitted -->8<!-- raw HTML omitted --><!-- raw HTML omitted -->
Oh and did I mention? This thing is testable. And I have written a test
case for it<!-- raw HTML omitted --><!-- raw HTML omitted -->9<!-- raw HTML omitted --><!-- raw HTML omitted -->, which we shall see soon.</p>
<p>Now, the code for the <code>navtabs</code> directive, lines 75 to 94 of
<strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">directive</span>(<span style="color:#e6db74">&#39;navtabs&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">restrict</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;E&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">replace</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">templateUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;../static/navtabs.html&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">pageName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;=&#39;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">controller</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectTabIfOnPage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">tab</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">pageName</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                };
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>Ok, that looks complicated. And indeed it is.
In fact the original directive for the tab was not written this way.
I changed it to this after seeing an example on the AngularJS homepage.
I have to be honest and tell you that writing directives is <strong>not easy</strong>.
In fact, when I write a directive, I usually need to look up the official
AngularJS docs and read some stack overflow questions before I get it right.
But the effort is worth it once your directive is done.</p>
<p>Anyway, here goes. In a directive, we declare a function that returns an
object. This object is at the heart of writing directives, and there are
a number of properties for which you can set depending on what you intend
to do.</p>
<p>Here, we set the <code>restrict</code> property to the string <code>'E'</code> to say that it is
only meant to be used like a HTML element.
This is why we were able to use it like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">navtabs</span> <span style="color:#a6e22e">page-name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.pageName&#34;</span>&gt;&lt;/<span style="color:#f92672">navtabs</span>&gt;
</span></span></code></pre></div><p>even though <code>navtabs</code> is not a real HTML element.</p>
<p>There is also <code>'C'</code> (use as a class), <code>'A'</code> (use as an attribute) and the more
obscure <code>M</code> (use as a comment; I&rsquo;ve never used this before).
So if you want to use a directive like how you would use <code>ng-model</code> (like
an attribute), you will have to set restrict to the string <code>'A'</code>.</p>
<p>We will skip the <code>replace</code> property for now and look at the <code>templateUrl</code>
property. Just like its name suggests, this holds a path to the file
containing the template for this directive. Here is the full template
(<strong>static/navtabs.html</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav nav-tabs&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;todoList&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/&#34;</span>&gt;Home/Todo List&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secondPage&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/secondPage&#34;</span>&gt;Second Page&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">ul</span>&gt;
</span></span></code></pre></div><p>Ah&hellip; the picture becomes more clear. We are using a
<!-- raw HTML omitted -->Twitter Bootstrap<!-- raw HTML omitted -->
navtab, hence the <code>&lt;ul&gt;</code> element with the <code>nav</code> and <code>nav-tabs</code> CSS classes.
The two <code>&lt;tab&gt;</code> elements inside are themselves directives (which we will
cover very shortly), but they should look quite intuitive.</p>
<p>Now, let&rsquo;s look at the <code>replace</code> property, at line 78 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">replace</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span></code></pre></div><p>When set to <code>true</code>, it means we want to replace the entire <code>&lt;navtabs&gt;</code>
element with the template. The alternative is <code>false</code>, which will insert
the template under the <code>&lt;navtabs&gt;</code> element.
Yea it does work even though <code>&lt;navtabs&gt;</code> is not a real HTML tag.</p>
<p>Still on <strong>static/todo.js</strong>, lines 80 to 82:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pageName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;=&#39;</span>
</span></span><span style="display:flex;"><span>},
</span></span></code></pre></div><p>This is one of the more confusing aspects of writing directives, especially
when you are just starting out.
Earlier in this tutorial, I mentioned that AngularJS has an elaborate scope
hierarchy. It turns out that directives can have their own scope as well.
In fact, you&rsquo;ve seen an example in <code>ng-repeat</code>, where each <code>item</code> refers to
a different object. This could not have been possible if they were sharing
the same scope, since the same name should refer to the same object.</p>
<p>What we&rsquo;re doing here is, we are saying that the directive should have an
<strong>&lsquo;isolate&rsquo;</strong> scope. An isolate scope does not inherit from the parent scope.
In this case, the parent scope refers to the scope of the controller for
the page we are on (<code>TodoController</code> for the todo list page; <code>SecondController</code>
for the second page). An isolate scope is created for a directive when we
have a scope property whose value is an object, like what we have here.</p>
<p>Here, we see that the object has a property called <code>pageName</code>. The value of
the <code>pageName</code> is the string <code>'='</code>. Properties in this object are used to
specify scope properties, so this means we want a scope property named
<code>pageName</code>. That is half the story. The <code>'='</code> means we want to establish a
two-way data binding between <code>$scope.pageName</code> and the variable passed
to an attribute named <code>page-name</code> on the <code>&lt;navtabs&gt;</code> element. Confused?
Don&rsquo;t worry. Let&rsquo;s look at how we use the navtabs directive, on the first
line of <strong>static/todo.html</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">navtabs</span> <span style="color:#a6e22e">page-name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.pageName&#34;</span>&gt;&lt;/<span style="color:#f92672">navtabs</span>&gt;
</span></span></code></pre></div><p>Like we&rsquo;ve mentioned, there is a <code>page-name</code> attribute on the <code>&lt;navtabs&gt;</code>
element. It has a value of <code>state.pageName</code>. If we look at the <code>TodoController</code>
code at <strong>static/todo.js</strong>, line 30:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">pageName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;todoList&#39;</span>;
</span></span></code></pre></div><p>We see that there is indeed a scope variable called <code>$scope.state.pageName</code>
set up in <code>TodoController</code>.</p>
<p>If we look at the other place where the <strong><!-- raw HTML omitted --></strong> element is used,
namely the first line of <strong>static/secondPage.html</strong>, we see the same line
of HTML:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">navtabs</span> <span style="color:#a6e22e">page-name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.pageName&#34;</span>&gt;&lt;/<span style="color:#f92672">navtabs</span>&gt;
</span></span></code></pre></div><p>And code for the <code>SecondController</code>, line 111 to 117 of <strong>static/todo.js</strong>,
in particular line 115:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">controller</span>(<span style="color:#e6db74">&#39;SecondController&#39;</span>, [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">pageName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;secondPage&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>])
</span></span></code></pre></div><p>We see a <code>$scope.state.pageName = 'secondPage';</code> assignment.</p>
<p>If we take a look at the template file for the <code>navtabs</code> directive again
(<strong>static/navtabs.html</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav nav-tabs&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;todoList&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/&#34;</span>&gt;Home/Todo List&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secondPage&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/secondPage&#34;</span>&gt;Second Page&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">ul</span>&gt;
</span></span></code></pre></div><p>See something special? I am referring to the <code>name=&quot;todoList&quot;</code> and
<code>name=&quot;secondPage&quot;</code> attributes.</p>
<p>Hopefully you see where we are going. On the todo list page, I set up
<code>$scope.state.pageName</code> in the <code>TodoController</code> to have the value <code>'todoList'</code>,
and on the second page, I set up the <code>$scope.state.pageName</code> in the
<code>SecondController</code> to have the value <code>'secondPage'</code>.
Compare that to the value of the <code>name</code> attribute in the two <code>&lt;tab&gt;</code> elements
in the template file of the <code>navtabs</code> directive, and it should be obvious what
we are trying to do - we want the tab with its name attribute equal to the
value of <code>$scope.state.pageName</code> (as set up in the current controller, whichever
one it might be) to be the active tab.</p>
<p>Looking at on <strong>static/todo.js</strong>, lines 80 to 82:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pageName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;=&#39;</span>
</span></span><span style="display:flex;"><span>},
</span></span></code></pre></div><p>and a use case:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">navtabs</span> <span style="color:#a6e22e">page-name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.pageName&#34;</span>&gt;&lt;/<span style="color:#f92672">navtabs</span>&gt;
</span></span></code></pre></div><p>See the difference between the scope property <code>pageName</code> and the
attribute <code>page-name </code>on the <code>&lt;navtabs&gt;</code> element?
That is a pecularity of AngularJS.
For scope properties in camelCase, the corresponding attribute name will
be in lowercase, with a &lsquo;-&rsquo; inserted before all characters that were
originally in uppercase.</p>
<p>And the attribute name used in the <code>&lt;navtabs&gt;</code> element does not have to be
the same as the scope property name. You can specify it after the &lsquo;=&rsquo;, like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pageName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;=anothername&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>and it will be used like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">navtabs</span> <span style="color:#a6e22e">anothername</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.pageName&#34;</span>&gt;&lt;/<span style="color:#f92672">navtabs</span>&gt;
</span></span></code></pre></div><p>But I think it is good practice to use the same attribute name and scope
property name. It leads to less confusion.</p>
<p>Onto the final property we have not covered: <code>controller</code>. Look at lines
83 to 92 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">controller</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectTabIfOnPage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">tab</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">pageName</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>The <code>controller</code> property allows us to associate a controller with this
directive. This is strictly optional, and most of the directives I&rsquo;ve written
do not have a controller associated with it.
Here, we add a <code>selectTabIfOnPage</code> method to the controller itself.
We shall see what it does shortly.</p>
<p>Now, the <code>navtabs</code> directive is just half of the picture.
The other half lies in the <code>&lt;tab&gt;</code> directive, located at lines 95 to 110
of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">directive</span>(<span style="color:#e6db74">&#39;tab&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">require</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;^navtabs&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">restrict</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;E&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">replace</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">transclude</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> {},
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">template</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&lt;li ng-class=&#34;{ active: selected }&#34;&gt;&lt;a href=&#34;{{ href }}&#34; ng-transclude&gt;&lt;/a&gt;&lt;/li&gt;&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">link</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">scope</span>, <span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">attr</span>, <span style="color:#a6e22e">navtabsCtrl</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">href</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">navtabsCtrl</span>.<span style="color:#a6e22e">selectTabIfOnPage</span>(<span style="color:#a6e22e">scope</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>There are some similarities and differences between this directive and the
<code>navtabs</code> directive. Similarities include the <code>restrict</code>, <code>replace</code> and <code>scope</code>
properties. We shall focus on the other new properties.</p>
<p>The <code>require</code> property allows a directive to require another directive and
inject its controller as the fourth argument to the <code>link</code> function (discussed
in detail below). Here, the <code>tab</code> requires the <code>navtabs</code> directive, and the
controller of the <code>navtabs</code> directive will be made available to the link
function of the <code>tab</code> directive in its fourth parameter.</p>
<p>The <code>template</code> property is analogous to the <code>templateUrl</code> property, except
that we specify a string for the actual template instead of specifying a file
name.</p>
<p>The <code>transclude</code> property, when set to true, makes the content of the <code>&lt;tab&gt;</code>
element available to the <code>tab</code> directive<!-- raw HTML omitted --><!-- raw HTML omitted -->10<!-- raw HTML omitted --><!-- raw HTML omitted -->. Look at the template string:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">template</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&lt;li ng-class=&#34;{ active: selected }&#34;&gt;&lt;a href=&#34;{{ href }}&#34; ng-transclude&gt;&lt;/a&gt;&lt;/li&gt;&#39;</span>,
</span></span></code></pre></div><p>Observe that there is an <code>ng-transclude</code> directive on the <code>&lt;a&gt;</code> element.
This means that we want the content of the original <code>&lt;tab&gt;</code> element to
be placed beneath the <code>&lt;a&gt;</code> element in the template we see above.
Looking at the 2 use cases of the <code>tab</code> directive should make this more clear:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;todoList&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/&#34;</span>&gt;Home/Todo List&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secondPage&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/secondPage&#34;</span>&gt;Second Page&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span></code></pre></div><p>So we want the string <code>'Home/TodoList'</code> and <code>'Second Page'</code> to be placed within
the <code>&lt;a&gt;</code> element for each of the <code>&lt;tab&gt;</code> elements here.</p>
<p>Now, the final property, <code>link</code>, at lines 103 to 108 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">link</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">scope</span>, <span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">attr</span>, <span style="color:#a6e22e">navtabsCtrl</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">href</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">navtabsCtrl</span>.<span style="color:#a6e22e">selectTabIfOnPage</span>(<span style="color:#a6e22e">scope</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The value of the <code>link</code> property must be a function. The first three parameters
are pretty much the standard across any <code>link</code> function you write (you can
choose to name the parameters differently though).
Earlier, we mentioned that the <code>require: ^navtabs</code> property causes the
controller of the <code>navtabs</code> directive to be injected as the fourth argument
of the <code>link</code> function, so here it is in the <code>navtabsCtrl</code> parameter.</p>
<p>The link function is run whenever the DOM needs to be updated.</p>
<p>These two lines:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">href</span>;
</span></span></code></pre></div><p>assign the values of the <code>name</code> and <code>href</code> attributes of the <code>&lt;tab&gt;</code>
element to the scope object. Looking at the use cases of the <code>&lt;tab&gt;</code> element:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;todoList&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/&#34;</span>&gt;Home/Todo List&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secondPage&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/secondPage&#34;</span>&gt;Second Page&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span></code></pre></div><p>We see that indeed, both of them have the <code>name</code> and <code>href</code> attributes.</p>
<p>Line 106 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span></code></pre></div><p>sets a scope variable to false, and then line 107:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">navtabsCtrl</span>.<span style="color:#a6e22e">selectTabIfOnPage</span>(<span style="color:#a6e22e">scope</span>);
</span></span></code></pre></div><p>calls the <code>selectTabIfOnPage</code> function of the <code>navtabsCtrl</code> controller,
passing it the scope object as the argument.
Going back to the definition of the <code>selectTabIfOnPage</code> method of the
controller for the <code>navtabs</code> directive, at lines 83 to 92 of
<strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">controller</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectTabIfOnPage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">tab</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">pageName</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>The scope object for each <code>tab</code> directive is the argument to the
<code>selectTabIfOnPage</code> method here.
It sets the <code>selected</code> property of the tab object (which is the scope object
of the <code>tab</code> directive) to true if it matches the value of <code>$scope.pageName</code>
of the <code>navtabs</code> directive.
And <code>$scope.pageName</code> was originally set to the name of the tab which we want
to be active within one of <code>TodoController</code> and <code>SecondController</code>.</p>
<p>Looking at the template string of the <code>tab</code> directive again, at line 102
of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">template</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&lt;li ng-class=&#34;{ active: selected }&#34;&gt;&lt;a href=&#34;{{ href }}&#34; ng-transclude&gt;&lt;/a&gt;&lt;/li&gt;&#39;</span>,
</span></span></code></pre></div><p>We see that there is an <code>ng-class</code> directive on the <code>&lt;li&gt;</code> element.
Here, we supply a map consisting of one CSS class name, the <code>active</code> class.
Its value is given by the <code>scope.selected</code> variable, which will depend
on the outcome of the call to <code>selectTabIfOnPage</code> above.
If <code>scope.selected</code> is <code>true</code>, then the <code>&lt;li&gt;</code> element will have the <code>active</code>
css class applied to it. Otherwise, it will not have the <code>active</code> css class
applied to it.
You can supply multiple CSS classes to the map in the <code>ng-class</code> directive.
This is not the only way to use the <code>ng-class</code> directive.
You can read more <a href="http://docs.angularjs.org/api/ng.directive:ngClass">here</a>.</p>
<p>To recap how this works. Suppose we visit the todo list page.
At line 30 of <strong>static/todo.js</strong>, the <code>TodoController</code> sets</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">pageName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;todoList&#39;</span>;
</span></span></code></pre></div><p>The template for the todo list page gets rendered
(<strong>static/todo.html</strong>, line 1):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">navtabs</span> <span style="color:#a6e22e">page-name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;state.pageName&#34;</span>&gt;&lt;/<span style="color:#f92672">navtabs</span>&gt;
</span></span></code></pre></div><p>AngularJS sees the <code>&lt;navtabs&gt;</code> element and knows that it is a directive.
So <code>&lt;navtabs&gt;</code> gets expanded to its HTML template (<strong>static/navtabs.html</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav nav-tabs&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;todoList&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/&#34;</span>&gt;Home/Todo List&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secondPage&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/secondPage&#34;</span>&gt;Second Page&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">ul</span>&gt;
</span></span></code></pre></div><p>assigns <code>scope.pageName</code> with the string <code>'todoList'</code>, and associates
this controller with the directive (lines 83 to 92, <strong>static/todo.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">controller</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectTabIfOnPage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">tab</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">pageName</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>Then, AngularJS sees the 2 <code>&lt;tab&gt;</code> elements, and notices that they are
directives as well (<strong>static/navtabs.html</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nav nav-tabs&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;todoList&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/&#34;</span>&gt;Home/Todo List&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secondPage&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/secondPage&#34;</span>&gt;Second Page&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">ul</span>&gt;
</span></span></code></pre></div><p>so it proceeds to run this directive for the first <code>&lt;tab&gt;</code>
(lines 95 to 110, <strong>static/todo.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>.<span style="color:#a6e22e">directive</span>(<span style="color:#e6db74">&#39;tab&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">require</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;^navtabs&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">restrict</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;E&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">replace</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">transclude</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> {},
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">template</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&lt;li ng-class=&#34;{ active: selected }&#34;&gt;&lt;a href=&#34;{{ href }}&#34; ng-transclude&gt;&lt;/a&gt;&lt;/li&gt;&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">link</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">scope</span>, <span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">attr</span>, <span style="color:#a6e22e">navtabsCtrl</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">href</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">navtabsCtrl</span>.<span style="color:#a6e22e">selectTabIfOnPage</span>(<span style="color:#a6e22e">scope</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>The link function is run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">link</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">scope</span>, <span style="color:#a6e22e">element</span>, <span style="color:#a6e22e">attr</span>, <span style="color:#a6e22e">navtabsCtrl</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">attr</span>.<span style="color:#a6e22e">href</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scope</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">navtabsCtrl</span>.<span style="color:#a6e22e">selectTabIfOnPage</span>(<span style="color:#a6e22e">scope</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>and <code>scope.name</code> is assigned the value <code>'todoList'</code>,
<code>scope.href</code> is assigned the value <code>'#/'</code>,
<code>scope.selected</code> is assigned the value <code>false</code>.
Then, the function <code>navTabsCtrl.selectTabIfOnPage</code> gets called, with the
scope object of the <code>tab</code> directive getting passed in as the argument
(lines 86 to 92, <strong>static/todo.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectTabIfOnPage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">tab</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">pageName</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p><code>$scope.pageName</code> holds the value <code>'todoList'</code>, and <code>tab.name</code> (which refers
to <code>scope.name</code> of the <code>tab</code> directive) holds the value <code>'todoList'</code> as well.
As such, <code>tab.selected</code> (<code>scope.selected</code> of the <code>tab</code> directive) gets set
to <code>true</code>.</p>
<p>The <code>&lt;tab&gt;</code> element is replaced with its template
(line 102, <strong>static/todo.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">ng-class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{ active: selected }&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ href }}&#34;</span> <span style="color:#a6e22e">ng-transclude</span>&gt;&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">li</span>&gt;
</span></span></code></pre></div><p>AngularJS sees the <code>ng-class</code> directive, runs it, and finds that
<code>scope.selected</code> is <code>true</code>, then proceeds to apply the <code>active</code> CSS class
on the <code>&lt;li&gt;</code> element, giving us something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;active&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ href }}&#34;</span> <span style="color:#a6e22e">ng-transclude</span>&gt;&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">li</span>&gt;
</span></span></code></pre></div><p>The <code>href</code> of the <code>&lt;a&gt;</code> element gets the value of <code>scope.href</code>, which is <code>'#/'</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;active&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/&#34;</span> <span style="color:#a6e22e">ng-transclude</span>&gt;&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">li</span>&gt;
</span></span></code></pre></div><p>and the content of the <code>&lt;tab&gt;</code> element is made available within the <code>&lt;a&gt;</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;active&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/&#34;</span>&gt;Home/Todo List&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">li</span>&gt;
</span></span></code></pre></div><p>Of course, that is not the actual template generated. AngularJS does a lot
more behind the scenes. But this is sufficient to illustrate the idea.</p>
<p>As an exercise, you might want to work out what the other <code>&lt;tab&gt;</code> element
(line 3, <strong>static/navtabs.html</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">tab</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secondPage&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#/secondPage&#34;</span>&gt;Second Page&lt;/<span style="color:#f92672">tab</span>&gt;
</span></span></code></pre></div><p>gets expanded to. It looks very similar to the example we just worked out.</p>
<h2 id="optional---testing-the-custom-directive">Optional - Testing the custom directive</h2>
<p>This is the very last serious section of this tutorial.
Without further ado, look at lines 1 to 12 of
<strong>test/unit/TodoDirectives.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;TodoApp directive&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">$rootScope</span>
</span></span><span style="display:flex;"><span>      , <span style="color:#a6e22e">$compile</span>
</span></span><span style="display:flex;"><span>      , <span style="color:#a6e22e">$templateCache</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">beforeEach</span>(<span style="color:#a6e22e">module</span>(<span style="color:#e6db74">&#39;TodoApp&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">beforeEach</span>(<span style="color:#a6e22e">inject</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">_$rootScope_</span>, <span style="color:#a6e22e">_$compile_</span>, <span style="color:#a6e22e">_$templateCache_</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$rootScope</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_$rootScope_</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$compile</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_$compile_</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$templateCache</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_$templateCache_</span>;
</span></span><span style="display:flex;"><span>    }));
</span></span></code></pre></div><p>Most of this should be familiar. We inject 2 new services we have not seen
before, <code>$compile</code> and <code>$templateCache</code>. We shall see their uses shortly.</p>
<p>Now, look at lines 34 to 42 of <strong>test/unit/TodoDirectives.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;navtabs&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">$scope</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">beforeEach</span>(<span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$templateCache</span>.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#39;../static/navtabs.html&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;&lt;ul class=&#34;nav navtabs&#34;&gt;&#39;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;&lt;tab name=&#34;page1&#34; href=&#34;#&#34;&gt;Page One&lt;/tab&gt;&#39;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;&lt;tab name=&#34;tabtwo&#34; href=&#34;#/tabtwo&#34;&gt;Tab Two&lt;/tab&gt;&#39;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    });
</span></span></code></pre></div><p>We make use of the <code>$templateCache</code> service in the <code>beforeEach</code> block.
Recall that we made use of a <code>templateUrl</code> property in the definition
of the <code>navtabs</code> directive (line 79, <strong>static/todo.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">templateUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;../static/navtabs.html&#39;</span>,
</span></span></code></pre></div><p>Because we will be making use of the <code>navtabs</code> directive later on in a
test case, it will make a HTTP request for the <strong>../static/navtabs.html</strong> file.
While it is possible to supply the actual file through the use of some
libraries (see <a href="http://stackoverflow.com/questions/17223850/how-to-test-directives-that-use-templateurl-and-controllers">here</a> for an example),
we take the easy way out and just mock it out with a string.</p>
<p>Now, look at lines 43 to 55, <strong>test/unit/TodoDirectives.spec.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;should set the right tab to active&#39;</span>, <span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">navTabsElem</span>
</span></span><span style="display:flex;"><span>      , <span style="color:#a6e22e">linkFn</span>
</span></span><span style="display:flex;"><span>      , <span style="color:#a6e22e">liElems</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$rootScope</span>.<span style="color:#a6e22e">$new</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">pageName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;tabtwo&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">navTabsElem</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">angular</span>.<span style="color:#a6e22e">element</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&lt;navtabs page-name=&#34;state.pageName&#34;&gt;&lt;/navtabs&gt;&#39;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">linkFn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$compile</span>(<span style="color:#a6e22e">navTabsElem</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">linkFn</span>(<span style="color:#a6e22e">$scope</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$rootScope</span>.<span style="color:#a6e22e">$digest</span>();
</span></span></code></pre></div><p>Lines 47 to 49:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$rootScope</span>.<span style="color:#a6e22e">$new</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">pageName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;tabtwo&#39;</span>;
</span></span></code></pre></div><p>sets up a new scope and initializes the state.</p>
<p>Lines 50 to 53:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">navTabsElem</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">angular</span>.<span style="color:#a6e22e">element</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&lt;navtabs page-name=&#34;state.pageName&#34;&gt;&lt;/navtabs&gt;&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">linkFn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$compile</span>(<span style="color:#a6e22e">navTabsElem</span>);
</span></span></code></pre></div><p>creates a new <code>&lt;navtabs&gt;</code> element and compiles it, obtaining a link function.</p>
<p>Lines 54 and 55:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">linkFn</span>(<span style="color:#a6e22e">$scope</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$rootScope</span>.<span style="color:#a6e22e">$digest</span>();
</span></span></code></pre></div><p>calls the link function and passes the <code>$scope</code> variable as its argument,
then calls <code>$rootScope.$digest()</code>.</p>
<p>Most of this is more or less standard code when testing a directive, and
learnt from reading
<a href="http://stackoverflow.com/questions/12755421/how-to-test-angularjs-directives/12760618#12760618">this</a>
stackoverflow answer.</p>
<p>The rest of the test (lines 56 to 67, <strong>test/unit/TodoDirectives.spec.js</strong>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">liElems</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">navTabsElem</span>).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;li&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">liElems</span>[<span style="color:#ae81ff">0</span>])).<span style="color:#a6e22e">not</span>.<span style="color:#a6e22e">toHaveClass</span>(<span style="color:#e6db74">&#39;active&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">liElems</span>[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;a&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;href&#39;</span>)).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#39;#&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">liElems</span>[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;a&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;span&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">html</span>()
</span></span><span style="display:flex;"><span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#39;Page One&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">liElems</span>[<span style="color:#ae81ff">1</span>])).<span style="color:#a6e22e">toHaveClass</span>(<span style="color:#e6db74">&#39;active&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">liElems</span>[<span style="color:#ae81ff">1</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;a&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#39;href&#39;</span>))
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#39;#/tabtwo&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">liElems</span>[<span style="color:#ae81ff">1</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;a&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;span&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">html</span>()
</span></span><span style="display:flex;"><span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#39;Tab Two&#39;</span>);
</span></span></code></pre></div><p>should be pretty obvious, so I shall not go into details.
The only two new things are:</p>
<ol>
<li>
<p>It makes use of a custom jasmine matcher, defined in lines 16 to 31 of
<strong>test/unit/TodoDirectives.spec.js</strong>.
It is pretty much from <a href="http://testdrivenwebsites.com/2010/08/04/custom-jquery-matchers-in-jasmine/">this</a>
link.</p>
</li>
<li>
<p>It turns out the <code>ng-transclude</code> creates a <code>&lt;span&gt;</code> element to house
the transcluded stuff.</p>
</li>
</ol>
<p>In the <code>tab</code> directive, located at line 102 of <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">template</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&lt;li ng-class=&#34;{ active: selected }&#34;&gt;&lt;a href=&#34;{{ href }}&#34; ng-transclude&gt;&lt;/a&gt;&lt;/li&gt;&#39;</span>,
</span></span></code></pre></div><p>there is an <code>ng-transclude</code>. Hence the awkward looking tests</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">liElems</span>[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;a&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;span&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">html</span>()
</span></span><span style="display:flex;"><span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#39;Page One&#39;</span>);
</span></span></code></pre></div><p>and</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">expect</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">liElems</span>[<span style="color:#ae81ff">1</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;a&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">children</span>(<span style="color:#e6db74">&#39;span&#39;</span>)[<span style="color:#ae81ff">0</span>]).<span style="color:#a6e22e">html</span>()
</span></span><span style="display:flex;"><span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#39;Tab Two&#39;</span>);
</span></span></code></pre></div><p>Earlier, I mentioned that I am not entirely happy with the tests for
these 2 directives. If we look at lines 83 to 92, <strong>static/todo.js</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">controller</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;$scope&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">$scope</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">selectTabIfOnPage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">tab</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">$scope</span>.<span style="color:#a6e22e">pageName</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">selected</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>There is a controller within the <code>navtabs</code> directive which is not
<strong>unit tested</strong>. One solution is to shift it out as full fledged controller
within the <code>TodoApp</code> module so that it can be unit tested.</p>
<p>If you&rsquo;ve read everything, give yourself a pat on the back.
We have reached the end of the tutorial.</p>
<!-- raw HTML omitted -->
<p>Phew, that was a <strong>really</strong> long tutorial. I certainly did not expect it to
turn out to be this long. So for those of you who&rsquo;ve made it this far,
well done! I hope that you have learnt a thing or two about AngularJS.</p>
<p>If you&rsquo;ve forgot a lot of what&rsquo;s covered above, it&rsquo;s fine.
AngularJS is not exactly easy to learn if you&rsquo;re new to it, and this tutorial
is really, really long.</p>
<p>But if there are some points on AngularJS I wish that you can remember,
they are:</p>
<ul>
<li><strong>modules</strong> are the foundation of AngularJS applications</li>
<li>You can configure <strong>routes</strong> for an AngularJS module</li>
<li>The Model should be the one and only source of truth about the application
state.</li>
<li>Do not do <strong>any</strong> DOM manipulation in Controllers. Ever.
You should do them in directives.</li>
<li>For HTTP calls, make use of the <code>$http</code> service</li>
<li>Use <code>$window.alert</code>, <code>$window.confirm</code>, and other related
functions instead of using plain <code>alert</code> and <code>confirm</code>
This makes it possible for you to mock out those functions during
testing. We provided an example through the <code>windowAlert</code> factory above.</li>
<li>Make use of the
<a href="http://docs.angularjs.org/tutorial/step_05">array notation</a>
for specifying dependencies, especially if you want to minify your JavaScript</li>
<li>This isn&rsquo;t mentioned anywhere in the tutorial, but you can
use factories or services to wrap access to facilities from external
libraries when you use them. This makes it possible to mock them out
during testing.</li>
<li>AngularJS is designed with testing in mind. So do make it a point to
write some tests for your application.</li>
<li>Directives are hard to write. It is the norm to not get them right on
your first try. Do not be disheartened. Google and Stack Overflow are
your friends.</li>
<li>The AngularJS documentation is still a good source of information once
you get more acquainted with the framework. It just takes a lot of time
to understand what&rsquo;s written, though.</li>
<li>Do write some AngularJS tutorials when you become good at it.
The world needs more high quality AngularJS tutorials.
I sure hope this is one of them.</li>
</ul>
<p>Finally, here are some helpful links on AngularJS, some of them given
earlier in the tutorial:</p>
<h4 id="how-to-think-in-angularjs-if-i-have-a-jquery-background">How to think in AngularJS if I have a jQuery background</h4>
<ul>
<li><a href="http://stackoverflow.com/questions/14994391/how-do-i-think-in-angularjs-if-i-have-a-jquery-background">http://stackoverflow.com/questions/14994391/how-do-i-think-in-angularjs-if-i-have-a-jquery-background</a></li>
</ul>
<h4 id="on-services-vs-factories">On services vs. factories</h4>
<ul>
<li><a href="http://stackoverflow.com/questions/15666048/angular-js-service-vs-provider-vs-factory">http://stackoverflow.com/questions/15666048/angular-js-service-vs-provider-vs-factory</a></li>
<li><a href="http://stackoverflow.com/questions/13762228/confused-about-service-vs-factory">http://stackoverflow.com/questions/13762228/confused-about-service-vs-factory</a></li>
<li><a href="https://groups.google.com/forum/#!topic/angular/qYBkDDDyEw0">https://groups.google.com/forum/#!topic/angular/qYBkDDDyEw0</a></li>
</ul>
<h4 id="on-choosing-the-proper-scope-for-directives">On choosing the proper scope for directives</h4>
<ul>
<li><a href="http://stackoverflow.com/questions/14914213/when-writing-a-directive-how-do-i-decide-if-a-need-no-new-scope-a-new-child-sc">http://stackoverflow.com/questions/14914213/when-writing-a-directive-how-do-i-decide-if-a-need-no-new-scope-a-new-child-sc</a></li>
</ul>
<h4 id="difference-between--and--for-directives-with-isolate-scope">Difference between &lsquo;@&rsquo; and &lsquo;=&rsquo; for directives with isolate scope</h4>
<ul>
<li><a href="http://stackoverflow.com/questions/14050195/what-is-the-difference-between-and-in-directive-scope">http://stackoverflow.com/questions/14050195/what-is-the-difference-between-and-in-directive-scope</a></li>
</ul>
<h4 id="underscores-in-inject-angularjs-testing">Underscores in inject (AngularJS testing)</h4>
<ul>
<li><a href="http://stackoverflow.com/questions/15318096/what-does-the-underscores-in-servicename-mean-in-angularjs-tests">http://stackoverflow.com/questions/15318096/what-does-the-underscores-in-servicename-mean-in-angularjs-tests</a></li>
</ul>
<h4 id="how-to-test-angularjs-directives">How to test AngularJS directives</h4>
<ul>
<li><a href="http://stackoverflow.com/questions/12755421/how-to-test-angularjs-directives/12760618#12760618">http://stackoverflow.com/questions/12755421/how-to-test-angularjs-directives/12760618#12760618</a></li>
</ul>
<h4 id="testing-angularjs-directives-that-make-use-of-templateurl">Testing AngularJS directives that make use of templateUrl</h4>
<ul>
<li><a href="http://stackoverflow.com/questions/17223850/how-to-test-directives-that-use-templateurl-and-controllers">http://stackoverflow.com/questions/17223850/how-to-test-directives-that-use-templateurl-and-controllers</a></li>
</ul>
<h4 id="on-custom-jasmine-matchers">On custom Jasmine matchers</h4>
<ul>
<li><a href="https://github.com/pivotal/jasmine/wiki/Matchers">https://github.com/pivotal/jasmine/wiki/Matchers</a></li>
<li><a href="http://testdrivenwebsites.com/2010/08/04/custom-jquery-matchers-in-jasmine/">http://testdrivenwebsites.com/2010/08/04/custom-jquery-matchers-in-jasmine/</a></li>
</ul>
<h4 id="good-slides-on-angularjs-provides">Good slides on AngularJS $provides</h4>
<ul>
<li><a href="http://slides.wesalvaro.com/20121113/#/">http://slides.wesalvaro.com/20121113/#/</a></li>
</ul>
<p>Now then&hellip;</p>
<h2 id="credits">Credits</h2>
<p>If you are an author of any of the links/articles cited, I sincerely
thank you for sharing your knowledge of AngularJS with the rest of the world.
I certainly learnt a lot from you.</p>
<p>Big thanks to <a href="http://www.billpin.com/">BillPin</a> for offering me my summer
internship opportunity. Otherwise I will not know what I now know about
AngularJS.
Big thanks to Conor and Ruiwen for guiding me and answering my questions
during those 3 months.</p>
<p>And finally&hellip;
I know it&rsquo;s been tough on you, the reader. Here&rsquo;s my side of the story.</p>
<h2 id="closing-remarks--reflections">Closing Remarks / Reflections</h2>
<p>I&rsquo;ve always wanted to write an AngularJS tutorial, but I didn&rsquo;t expect it to
be this tough&hellip; It took me 2 full days to complete this, about half a day to
check it, and only 1 day to relearn Flask and AngularJS and write the
accompanying code.
It is really, really exhausting. So do be grateful for all the good AngularJS
tutorials that you have read! It wasn&rsquo;t easy for the authors to write them!</p>
<p>I&rsquo;d like to add that this is the most amount of writing I have ever done in
<strong>years</strong>. Any CS student, software developer, or anyone involved in a very
technical line of work will understand me. So, wow. I can&rsquo;t believe that
I have pulled through.</p>
<p>Finally (this is the last finally), thank you for reading this tutorial.
It is the first time I have ever written any kind of tutorial, not to mention
one on on a technical topic. I certainly hope that you have benefited
from it.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->

</div>

<div class="disclaimer">
  <p>Disclaimer: Opinions expressed on this blog are solely my own and do not express the views or opinions of my employer(s), past or present.</p>
</div><div id="disqus_thread"></div>
<script type="text/javascript">

(function () {
  
  
  if (window.location.hostname == "localhost")
    return;

  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  var disqus_shortname = 'pangyanhan';
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the</a></noscript>
<a href="http://disqus.com/">comments powered by <span>Disqus</span></a>
</div>

<script>mixpanel.track("page view", {"page": "https:\/\/yanhan.github.io\/posts\/2013-08-27-ngtut\/"})</script>

</main><footer>
  Copyright 2013 Yan Han Pang | <a href="https://github.com/dataCobra/hugo-vitae">Vitae</a> theme for <a href="https://gohugo.io">Hugo</a> 


    

</footer>
</body>
</html>
