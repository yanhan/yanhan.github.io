<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Using Swagger UI with any codebase - Pang Yan Han's blog</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Pang Yan Han">
        <link rel="stylesheet" href="../css/normalize.css">
        <link rel="stylesheet" href="../css/foundation.min.css">
        <link rel="stylesheet" href="../css/responsive-nav.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="../css/my-pygments-colorscheme.css">
        <link rel="stylesheet" href="../css/main.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

        <script src="../js/vendor/modernizr.js"></script>
        <script src="../js/responsive-nav.min.js"></script>
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
            tex2jax: {
              inlineMath: [ ["\\(", "\\)"] ],
              processEscapes: true
            }
          });
        </script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-49506023-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-49506023-1');
        </script>
    </head>

    <body>
      <div class="site">
        <div class="row">
          <div class="small-6 columns">
            <h1 class="title"><a href="../">Pang Yan Han's blog</a></h1>
          </div>
          <div class="small-6 columns">
            <div class="header-icons header-icons-translate show-for-medium-up">
              <a href="../atom.xml" target="_blank">
                <i class="fa fa-rss-square fa-4x"></i>
              </a>
              <a href="https://github.com/yanhan" target="_blank">
                <i class="fa fa-github-alt fa-4x"></i>
              </a>
              <a href="http://sg.linkedin.com/pub/yan-han-pang/92/158/91b" target="_blank">
                <i class="fa fa-linkedin fa-4x"></i>
              </a>
              <a href="https://twitter.com/yanhan_pang" target="_blank">
                <i class="fa fa-twitter fa-4x"></i>
              </a>
            </div>
            <div class="header-icons show-for-small-only">
              <a href="../atom.xml" target="_blank">
                <i class="fa fa-rss-square fa-2x"></i>
              </a>
              <a href="https://github.com/yanhan" target="_blank">
                <i class="fa fa-github-alt fa-2x"></i>
              </a>
              <a href="http://sg.linkedin.com/pub/yan-han-pang/92/158/91b" target="_blank">
                <i class="fa fa-linkedin fa-2x"></i>
              </a>
              <a href="https://twitter.com/yanhan_pang" target="_blank">
                <i class="fa fa-twitter fa-2x"></i>
              </a>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="small-12 columns">
            <nav class="header nav-collapse">
              <ul>
                <li><a class="extra" href="../">home</a></li>
                <li><a class="extra" href="../about.html">about</a></li>
                <li><a class="extra" href="../bookshelf.html">bookshelf</a></li>
                <li><a class="extra" href="../interesting-talks.html">interesting talks</a></li>
                <li><a class="extra" href="../archive.html">archive</a></li>
              </ul>
            </nav>
          </div>
        </div>

        <div class="row">
          <div class="small-12 columns">
            <h2>Using Swagger UI with any codebase</h2>
<p class="meta">
  26 Nov 2017,
  
    by <span class="italic">Pang Yan Han</span>
  
</p>
<div class="post-tags">
  <i class="fa fa-tags"></i>Tags: <a href="../tags/swagger.html">swagger</a>, <a href="../tags/swagger-ui.html">swagger-ui</a>
</div>
<div class="post">
  <p>This post shows you how to use Swagger UI with any codebase. There are <strong>no library dependencies</strong> once you extract the assets. The only things you need are a web server and a file containing the API documentation in the <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.0.md">OpenAPI format</a>.</p>
<p>At the end of the post, you should be able to use your web server to host API documentation that looks something like <a href="http://petstore.swagger.io/">http://petstore.swagger.io</a></p>
<p>Like many of my posts, this is technical and there are instructions you have to follow.</p>
<h2 id="accompanying-code">Accompanying code</h2>
<p>The GitHub repo is at <a href="https://github.com/yanhan/swagger-ui-any-codebase" class="uri">https://github.com/yanhan/swagger-ui-any-codebase</a></p>
<p>We will be making use of some files there in this demo.</p>
<h2 id="the-big-picture">The big picture</h2>
<p>We will be making use of the <a href="https://www.npmjs.com/package/swagger-ui-dist">swagger-ui-dist</a> npm package and extracting the assets from there. To do so, we will be using <a href="https://github.com/creationix/nvm">nvm</a> to install npm and use npm to install swagger-ui-dist. Once that is done, we can extract the assets.</p>
<p>With the assets and an API documentation file, we can use a web server to serve the API documentation Swagger UI style.</p>
<h2 id="create-a-new-directory">Create a new directory</h2>
<p>Create a new directory somewhere to reduce clutter. We will be doing everything in this new directory.</p>
<h2 id="extracting-static-assets-for-swagger-ui">Extracting static assets for Swagger UI</h2>
<p>This section focuses on extracting the static assets required by Swagger UI.</p>
<h3 id="installing-nvm">Installing nvm</h3>
<p>Follow the instructions at the <a href="https://github.com/creationix/nvm#install-script">nvm GitHub README</a>. I have copied and pasted what I used:</p>
<div class="highlight"><pre><span></span>curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.6/install.sh | bash
</pre></div>

<p>nvm allows us to install multiple versions of Nodejs without having to override the system’s Nodejs.</p>
<h3 id="install-nodejs-using-nvm">Install Nodejs using nvm</h3>
<p>I am using Nodejs 8.9.1 in this demo. I believe any 8.x Nodejs should work.</p>
<div class="highlight"><pre><span></span>nvm install 8.9.1
</pre></div>

<h3 id="install-swagger-ui-dist">Install swagger-ui-dist</h3>
<p>Create a <code>package.json</code> file with the following contents:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;swagger-ui-dist&quot;</span><span class="o">:</span> <span class="s2">&quot;~3.5.0&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Then activate Nodejs 8.9.1 and install the package:</p>
<div class="highlight"><pre><span></span>nvm use 8.9.1
npm install
</pre></div>

<p>You should see a <code>node_modules</code> directory. We will be extracting the static assets of <code>swagger-ui-dist</code> from it soon.</p>
<h3 id="extract-static-assets">Extract static assets</h3>
<p>Copy the <code>node_modules/swagger-ui-dist</code> directory:</p>
<div class="highlight"><pre><span></span>cp -R node_modules/swagger-ui-dist .
</pre></div>

<p>In the <code>swagger-ui-dist</code> directory, there is a file named <code>index.html</code>. Use a text editor to open that file and go to line 76. You should see code like this:</p>
<div class="highlight"><pre><span></span>  <span class="kr">const</span> <span class="nx">ui</span> <span class="o">=</span> <span class="nx">SwaggerUIBundle</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;http://petstore.swagger.io/v2/swagger.json&quot;</span><span class="p">,</span>
</pre></div>

<p>For purposes of the demo below, modify the value of the <code>url</code> key so that it looks like:</p>
<div class="highlight"><pre><span></span>  <span class="kr">const</span> <span class="nx">ui</span> <span class="o">=</span> <span class="nx">SwaggerUIBundle</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;/api-docs.yml&quot;</span><span class="p">,</span>
</pre></div>

<p>This is telling the code to fire a request to <code>/api-docs.yml</code> to load the API documentation. Feel free to change the name of this endpoint, as long as you configure your web server supports it and return the correct file.</p>
<p>In fact, you can copy / move the entire <code>swagger-ui-dist</code> directory to your web server’s repository and take things from there (while skipping the rest of this article). If you are unsure on how to proceed, carry on reading so you can see a demo of how we incorporate some example API documentation so it is hosted on a Flask server.</p>
<h2 id="demo-using-flask-server-using-docker">Demo using Flask server (using Docker)</h2>
<p>This is the easy way.</p>
<p>Simply clone <a href="https://github.com/yanhan/swagger-ui-any-codebase" class="uri">https://github.com/yanhan/swagger-ui-any-codebase</a> and run the following commands to build the Docker image and run it:</p>
<div class="highlight"><pre><span></span>./build-docker.sh
./run-docker.sh
</pre></div>

<p>Then go to <code>http://127.0.0.1:5000/swagger-ui</code> . Tadah!</p>
<h2 id="demo-using-flask-server-not-using-docker">Demo using Flask server (not using Docker)</h2>
<p>This is the hard way. With the Docker option, I don’t really recommend doing this unless you want to familiarize yourself with the pyenv toolchain.</p>
<h3 id="install-pyenv">Install pyenv</h3>
<p>Follow the instructions at the <a href="https://github.com/pyenv/pyenv#installation">pyenv GitHub README</a> to install pyenv. I used the instructions at the <a href="https://github.com/pyenv/pyenv-installer">pyenv-installer</a> to install pyenv. Specifically, the following command:</p>
<div class="highlight"><pre><span></span>curl -L https://raw.githubusercontent.com/pyenv/pyenv-installer/master/bin/pyenv-installer | bash
</pre></div>

<h3 id="install-python-3.6.3-using-pyenv">Install Python 3.6.3 using pyenv</h3>
<p>Now we install Python 3.6.3 using pyenv. Any version of Python 3.x should work fine.</p>
<div class="highlight"><pre><span></span>pyenv install 3.6.3
</pre></div>

<p>If you encounter any errors installing pyenv, google is your friend.</p>
<h3 id="create-a-virtualenv-for-this-demo">Create a virtualenv for this demo</h3>
<p>We will be creating a virtualenv to install Flask. We will be naming it <code>swagger-demo</code>.</p>
<div class="highlight"><pre><span></span>pyenv virtualenv 3.6.3 swagger-demo
</pre></div>

<h3 id="install-flask">Install Flask</h3>
<p>Now we will be installing Flask inside the <code>swagger-demo</code> virtualenv:</p>
<div class="highlight"><pre><span></span>pyenv activate swagger-demo
pip install -r requirements.txt
</pre></div>

<h3 id="web-server-code">Web server code</h3>
<p>Get it from <a href="https://github.com/yanhan/swagger-ui-any-codebase/blob/master/server.py" class="uri">https://github.com/yanhan/swagger-ui-any-codebase/blob/master/server.py</a> and save it as <code>server.py</code>.</p>
<p>We will be going through some of the code later.</p>
<h3 id="api-docs.yml-file">api-docs.yml file</h3>
<p>Get it from <a href="https://github.com/yanhan/swagger-ui-any-codebase/blob/master/api-docs.yml" class="uri">https://github.com/yanhan/swagger-ui-any-codebase/blob/master/api-docs.yml</a> and save it as <code>api-docs.yml</code>.</p>
<p>This is our example API documentation saved as a YAML file.</p>
<h3 id="running-the-server">Running the server</h3>
<div class="highlight"><pre><span></span>python server.py
</pre></div>

<p>Then go to <a href="http://127.0.0.1:5000/swagger-ui" class="uri">http://127.0.0.1:5000/swagger-ui</a> to see the documentation. Tadah!</p>
<h2 id="how-everything-works">How everything works</h2>
<p>Understand this section and you can adapt the Swagger UI assets to any codebase you are using. You are recommended to open <a href="https://github.com/yanhan/swagger-ui-any-codebase/blob/master/server.py" class="uri">https://github.com/yanhan/swagger-ui-any-codebase/blob/master/server.py</a> and refer to it as we explain the code.</p>
<p>Recall that earlier we extracted the <code>swagger-ui-dist</code> directory from the swagger-ui-dist NPM package. That directory contains all the static assets required. We just need to find a way for the server to deliver the <code>swagger-ui-dist/index.html</code> file on a user request.</p>
<p>Notice that to see the docs, we go to the path <code>/swagger-ui</code>, which serves the <code>swagger-ui-dist/index.html</code> file. Which implies that our web server must have an endpoint for this path taht serves the file. For our demo, it is right here:</p>
<div class="highlight"><pre><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/swagger-ui/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">swagger_ui</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="n">SWAGGER_UI_DIST_DIR</span><span class="p">,</span> <span class="s2">&quot;index.html&quot;</span><span class="p">)</span>
</pre></div>

<p>This tells Flask to return the <code>index.html</code> page from our <code>swagger-ui-dist</code> directory. Recall that earlier, we modified that file so the <code>SwaggerUIBundle</code> has its <code>url</code> value changed:</p>
<div class="highlight"><pre><span></span>  <span class="kr">const</span> <span class="nx">ui</span> <span class="o">=</span> <span class="nx">SwaggerUIBundle</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;/api-docs.yml&quot;</span><span class="p">,</span>
</pre></div>

<p>which implies we must have another route to <code>/api-docs.yml</code> that returns the file containing the API documentation. Indeed, it is here:</p>
<div class="highlight"><pre><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/api-docs.yml&quot;</span><span class="p">)</span>
<span class="nd">@nocache</span>
<span class="k">def</span> <span class="nf">swagger_api_docs_yml</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;api-docs.yml&quot;</span><span class="p">)</span>
</pre></div>

<p>The endpoint and the filename do not have to be the same as long as the endpoint you are using returns the correct file; you can use whatever name you like for the endpoint and the filename. We are only using the same name to reduce confusion. I added the <code>nocache</code> decorator so that the docs served by the Flask server will be updated as I save the actual file and refresh my browser. Credits to <a href="https://arusahni.net/blog/2014/03/flask-nocache.html">Aru Sahni’s blog post</a> for this code.</p>
<p>Finally, if we open <code>swagger-ui-dist/index.html</code>, we will see some references to other static assets with the <code>./</code> prefix, for instance:</p>
<div class="highlight"><pre><span></span>./swagger-ui.css
./favicon-32x32.png
./favicon-16x16.png
</pre></div>

<p>These are all available at the <code>swagger-ui-dist</code> directory. Due to the <code>./</code> and the fact that we are hosting the API docs at <code>/swagger-ui</code>, these assets will be requested from the web server under <code>/swagger-ui</code>. For instance, <code>/swagger-ui/favicon-32x32.png</code>.</p>
<p>Hence we need an endpoint for serving these assets, right here:</p>
<div class="highlight"><pre><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/swagger-ui/&lt;asset&gt;&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">swagger_assets</span><span class="p">(</span><span class="n">asset</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="n">SWAGGER_UI_DIST_DIR</span><span class="p">,</span> <span class="n">asset</span><span class="p">)</span>
</pre></div>

<p>If we do not do this step, we will be able to load <code>/swagger-ui</code> but fail to load the other static assets. Open the Network Inspector / similar of your web browser and you will see a number of 404s. In fact, that was how I debugged the problem.</p>
<h2 id="security-implications">Security implications</h2>
<p>The big drawback to this approach is security. Specifically, exposure of internal API docs to the public Internet. Here, I highlight some concerns that I see.</p>
<ol style="list-style-type: decimal">
<li>Please disable this endpoint for production. In fact, you should write this code immediately so you don’t forget about it.</li>
<li>If you are writing docs for an internal API, please take care not to expose this documentation to the Internet. Minimally, your web server should not have a public IP address and should be on a private network that is only accessible using a VPN.</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>And that completes our explanation of the web server code. Hopefully, you will be able to adapt this to any codebase.</p>
</div>
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'pangyanhan'; // required: replace example with your forum shortname
        var disqus_identifier = "posts/2017-11-26-using-swagger-ui-with-any-codebase.md";
        var disqus_url = "http://blog.pangyanhan.com/posts/2017-11-26-using-swagger-ui-with-any-codebase.html";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>
        </div>

        <div class="row footer">
          <div class="medium-12 columns">
            <div class="footer-item">
              <span>Github</span>
              <a href="https://github.com/yanhan/">github.com/yanhan</a>
            </div>
            <div class="hakyll-line">
              Site proudly generated by
              <a href="http://jaspervdj.be/hakyll" target="_blank">Hakyll</a>
            </div>
          </div>
        </div>
      </div>

      <script src="../js/vendor/jquery.js"></script>
      <script src="../js/foundation.min.js"></script>
      <script>
        $(document).foundation();
        var navigation = responsiveNav(".nav-collapse", {
          animate: true,
          transition: 284,
          label: "",
          insert: "after",
          openPos: "relative",
          navActiveClass: "js-nav-active"
        });
      </script>
    </body>
</html>
