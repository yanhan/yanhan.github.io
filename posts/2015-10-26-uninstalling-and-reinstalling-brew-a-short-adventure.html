<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>How to uninstall then install brew: a short adventure - Pang Yan Han's blog</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Pang Yan Han">
        <link rel="stylesheet" href="../css/normalize.css">
        <link rel="stylesheet" href="../css/foundation.min.css">
        <link rel="stylesheet" href="../css/responsive-nav.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="../css/my-pygments-colorscheme.css">
        <link rel="stylesheet" href="../css/main.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

        <script src="../js/vendor/modernizr.js"></script>
        <script src="../js/responsive-nav.min.js"></script>
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
            tex2jax: {
              inlineMath: [ ["\\(", "\\)"] ],
              processEscapes: true
            }
          });
        </script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-49506023-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-49506023-1');
        </script>
    </head>

    <body>
      <div class="site">
        <div class="row">
          <div class="small-6 columns">
            <h1 class="title"><a href="../">Pang Yan Han's blog</a></h1>
          </div>
          <div class="small-6 columns">
            <div class="header-icons header-icons-translate show-for-medium-up">
              <a href="../atom.xml" target="_blank">
                <i class="fa fa-rss-square fa-4x"></i>
              </a>
              <a href="https://github.com/yanhan" target="_blank">
                <i class="fa fa-github-alt fa-4x"></i>
              </a>
              <a href="http://sg.linkedin.com/pub/yan-han-pang/92/158/91b" target="_blank">
                <i class="fa fa-linkedin fa-4x"></i>
              </a>
              <a href="https://twitter.com/yanhan_pang" target="_blank">
                <i class="fa fa-twitter fa-4x"></i>
              </a>
            </div>
            <div class="header-icons show-for-small-only">
              <a href="../atom.xml" target="_blank">
                <i class="fa fa-rss-square fa-2x"></i>
              </a>
              <a href="https://github.com/yanhan" target="_blank">
                <i class="fa fa-github-alt fa-2x"></i>
              </a>
              <a href="http://sg.linkedin.com/pub/yan-han-pang/92/158/91b" target="_blank">
                <i class="fa fa-linkedin fa-2x"></i>
              </a>
              <a href="https://twitter.com/yanhan_pang" target="_blank">
                <i class="fa fa-twitter fa-2x"></i>
              </a>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="small-12 columns">
            <nav class="header nav-collapse">
              <ul>
                <li><a class="extra" href="../">home</a></li>
                <li><a class="extra" href="../about.html">about</a></li>
                <li><a class="extra" href="../bookshelf.html">bookshelf</a></li>
                <li><a class="extra" href="../interesting-talks.html">interesting talks</a></li>
                <li><a class="extra" href="../archive.html">archive</a></li>
              </ul>
            </nav>
          </div>
        </div>

        <div class="row">
          <div class="small-12 columns">
            <h2>How to uninstall then install brew: a short adventure</h2>
<p class="meta">
  26 Oct 2015,
  
    by <span class="italic">Pang Yan Han</span>
  
</p>
<div class="post-tags">
  <i class="fa fa-tags"></i>Tags: <a href="../tags/brew.html">brew</a>, <a href="../tags/homebrew.html">homebrew</a>, <a href="../tags/mac.html">mac</a>
</div>
<div class="post">
  <p>Roughly 2 weeks ago I was writing a Bash script to automate some stuff, one of them being installing brew. To test if this script was working, I needed to uninstall brew. So I googled for it and came across <a href="https://github.com/Homebrew/homebrew/blob/master/share/doc/homebrew/FAQ.md#how-do-i-uninstall-homebrew">the homebrew FAQ</a> which says to run the following:</p>
<div class="highlight"><pre><span></span>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)&quot;
</pre></div>

<p>which I did.</p>
<p>Then I proceeded to run my script, which contains the following line of code (from the <a href="http://brew.sh">brew website</a>) to install brew:</p>
<div class="highlight"><pre><span></span>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</pre></div>

<p>However, this command caused the following error:</p>
<blockquote>
<p>It appears Homebrew is already installed. If your intent is to reinstall you</p>
<p>should do the following before running this installer again:</p>
<p>    ruby -e “$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)”</p>
</blockquote>
<p>Ok, I thought I uninstalled brew already. Never mind, maybe the uninstallation script went wrong. So I ran it again:</p>
<div class="highlight"><pre><span></span>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)&quot;
</pre></div>

<p>and if memory serves (after all, it was about 2 weeks ago), I got the following error:</p>
<div class="highlight"><pre><span></span>Failed to locate Homebrew!
</pre></div>

<p>Ok… let’s install brew again:</p>
<div class="highlight"><pre><span></span>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</pre></div>

<p>and I got the same error again:</p>
<blockquote>
<p>It appears Homebrew is already installed. If your intent is to reinstall you</p>
<p>should do the following before running this installer again:</p>
<p>    ruby -e “$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)”</p>
</blockquote>
<p>Wtf.</p>
<p>Refusing to believe this, I probably went through the cycle at least 2 more times. I have seen and know the definition of insanity, which is:</p>
<blockquote>
<p>doing the same thing over and over again and expecting different results.</p>
</blockquote>
<p>and I was definitely not insane. So to solve this problem, I had to do something different. I googled around but couldn’t find anything helpful. After some time, the following thought firmly presented itself in my mind: <strong>I screwed up my brew installation and there is a chance I won’t be able to install brew again</strong>.</p>
<p>But I needed brew back. And while there is indeed a chance that I screwed things up so bad that I wouldn’t be able to install brew ever again, that’s a pretty slim chance. <strong>I knew for a fact that brew was uninstalled</strong>, because 1. brew itself was gone and 2. all the programs that were installed using brew were gone as well. So the uninstallation mostly worked properly. The script that fucked up was probably the installation script. I knew that I’d have to look inside the brew installation script to see what went wrong. Kind of intimidating. I was also pretty tired and needed a break, so I went for one.</p>
<p>After my break, I downloaded the brew installation script file. Ok. So it’s over 200 but below 300 line of ruby code. Not so intimidating after all. Then I looked around for text that resembled the above error I got that complained about brew being installed on my system. And I found it! Here’s how the ruby code looked like:</p>
<div class="highlight"><pre><span></span><span class="nb">abort</span> <span class="o">&lt;&lt;-</span><span class="dl">EOABORT</span> <span class="k">unless</span> <span class="no">Dir</span><span class="o">[</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">HOMEBREW_PREFIX</span><span class="si">}</span><span class="s2">/.git/*&quot;</span><span class="o">].</span><span class="n">empty?</span>
<span class="sh">It appears Homebrew is already installed. If your intent is to reinstall you</span>
<span class="sh">should do the following before running this installer again:</span>
<span class="sh">    ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)&quot;</span>
<span class="dl">EOABORT</span>
</pre></div>

<p>Hmm, so to trigger this abort, <code>Dir[&quot;#{HOMEBREW_PREFIX}/.git/*&quot;].empty?</code> must be false. So what is <code>HOMEBREW_PREFIX</code> ? Turns out it’s defined right at the top of the brew installation script as <code>/usr/local</code> . Ok, so <code>/usr/local/.git</code> must be present on my mac. And indeed it is. That’s the cause of the error. And indeed it looks like a <code>.git</code> directory whenever one clones a git repository. Let’s remove it:</p>
<div class="highlight"><pre><span></span>rm -rf /usr/local/.git
</pre></div>

<p>And run the brew installation script:</p>
<div class="highlight"><pre><span></span>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</pre></div>

<p>which worked flawlessly this time.</p>
<p>What did I learn from this?</p>
<ol style="list-style-type: decimal">
<li>Taking a break can be very helpful when you’ve gotten stuck on a problem for a long time. It may seem counterintuitive, but it has worked for me many, many times.</li>
<li>Do not put anything on a pedestal - you can achieve more than you think and usually a lot of things are not as intimidating as they seem once you get down to them. I thought that it will be very intimidating to look into the brew installation script to find out what’s causing the error I was getting, but I was pleasantly surprised both by the amount of code I had to read (not a lot) and the ease with which I diagnosed the problem. Of course, not everything is as straightforward as this but often times they’re not as scary as we think - it all depends on how determined we are towards solving the problem. That being said, opening up the brew installation script to find out the error (after I’ve taken my break of course) wouldn’t have been as straightforward a decision to make if I hadn’t had the experience of “opening up the box” many, many times by looking into other people’s code, finding out what’s wrong and fixing the error. I’ve clearly forgotten when I first had to do this but, the first step I took was extremely important.</li>
</ol>
</div>
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'pangyanhan'; // required: replace example with your forum shortname
        var disqus_identifier = "posts/2015-10-26-uninstalling-and-reinstalling-brew-a-short-adventure.md";
        var disqus_url = "http://blog.pangyanhan.com/posts/2015-10-26-uninstalling-and-reinstalling-brew-a-short-adventure.html";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>
        </div>

        <div class="row footer">
          <div class="medium-12 columns">
            <div class="footer-item">
              <span>Github</span>
              <a href="https://github.com/yanhan/">github.com/yanhan</a>
            </div>
            <div class="hakyll-line">
              Site proudly generated by
              <a href="http://jaspervdj.be/hakyll" target="_blank">Hakyll</a>
            </div>
          </div>
        </div>
      </div>

      <script src="../js/vendor/jquery.js"></script>
      <script src="../js/foundation.min.js"></script>
      <script>
        $(document).foundation();
        var navigation = responsiveNav(".nav-collapse", {
          animate: true,
          transition: 284,
          label: "",
          insert: "after",
          openPos: "relative",
          navActiveClass: "js-nav-active"
        });
      </script>
    </body>
</html>
