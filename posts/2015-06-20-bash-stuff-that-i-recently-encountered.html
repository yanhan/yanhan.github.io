<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Bash stuff I recently encountered</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Pang Yan Han">
        <link rel="stylesheet" href="../css/normalize.css">
        <link rel="stylesheet" href="../css/foundation.min.css">
        <link rel="stylesheet" href="../css/responsive-nav.css">
        <link href="http://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="../css/my-pygments-colorscheme.css">
        <link rel="stylesheet" href="../css/main.css">
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

        <script src="../js/vendor/modernizr.js"></script>
        <script src="../js/responsive-nav.min.js"></script>
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
            tex2jax: {
              inlineMath: [ ["\\(", "\\)"] ],
              processEscapes: true
            }
          });
        </script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
    </head>

    <body>
      <div class="site">
        <div class="row">
          <div class="small-6 columns">
            <h1 class="title"><a href="../">yan han's blog</a></h1>
          </div>
          <div class="small-6 columns">
            <div class="header-icons header-icons-translate show-for-medium-up">
              <a href="https://github.com/yanhan" target="_blank">
                <i class="fa fa-github-alt fa-4x"></i>
              </a>
              <a href="http://sg.linkedin.com/pub/yan-han-pang/92/158/91b" target="_blank">
                <i class="fa fa-linkedin fa-4x"></i>
              </a>
              <a href="https://twitter.com/yanhan_pang" target="_blank">
                <i class="fa fa-twitter fa-4x"></i>
              </a>
            </div>
            <div class="header-icons show-for-small-only">
              <a href="https://github.com/yanhan" target="_blank">
                <i class="fa fa-github-alt fa-2x"></i>
              </a>
              <a href="http://sg.linkedin.com/pub/yan-han-pang/92/158/91b" target="_blank">
                <i class="fa fa-linkedin fa-2x"></i>
              </a>
              <a href="https://twitter.com/yanhan_pang" target="_blank">
                <i class="fa fa-twitter fa-2x"></i>
              </a>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="small-12 columns">
            <nav class="header nav-collapse">
              <ul>
                <li><a class="extra" href="../">home</a></li>
                <li><a class="extra" href="../about.html">about</a></li>
                <li><a class="extra" href="../haskell">Haskell</a></li>
                <li><a class="extra" href="../bookshelf.html">bookshelf</a></li>
                <li><a class="extra" href="../interesting-talks.html">interesting talks</a></li>
                <li><a class="extra" href="../archive.html">archive</a></li>
              </ul>
            </nav>
          </div>
        </div>

        <div class="row">
          <div class="small-12 columns">
            <h2>Bash stuff I recently encountered</h2>
<p class="meta">
  20 Jun 2015,
  
    by <span class="italic">Pang Yan Han</span>
  
</p>
<div class="post-tags">
  <i class="fa fa-tags"></i>Tags: <a href="../tags/bash.html">bash</a>
</div>
<div class="post">
  <p>Last week, I’ve been working on my <a href="https://github.com/yanhan/provision-ubuntu">provision-ubuntu</a> repository and getting it in a better shape to put in on Github.</p>
<p>Part of what I wanted to do was to create a Bash script for starting up everything and for some reason, instead of using an Ansible module to do it, I decided to use a Bash script to:</p>
<p>Add the PPA for git, provided that it has not already been added.</p>
<p>I broke this down into 2 main steps:</p>
<ol style="list-style-type: decimal">
<li>Getting the list of added PPAs</li>
<li>Checking if the git PPA is inside the list of PPAs. If it is not, we add it.</li>
</ol>
<h2 id="first-order-of-business---get-the-list-of-added-ppas">First order of business - Get the list of added PPAs</h2>
<p>Some googling led to <a href="http://askubuntu.com/a/148968">this very nice answer</a> by stwissel.</p>
<p>I’ll copy and paste the relevant code snippet here:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># listppa Script to get all the PPA installed on a system ready to share for reininstall</span>
<span class="k">for</span> APT in <span class="sb">`</span>find /etc/apt/ -name <span class="se">\*</span>.list<span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
    grep -o <span class="s2">&quot;^deb http://ppa.launchpad.net/[a-z0-9\-]\+/[a-z0-9\-]\+&quot;</span> <span class="nv">$APT</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> ENTRY <span class="p">;</span> <span class="k">do</span>
        <span class="nv">USER</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f4<span class="sb">`</span>
        <span class="nv">PPA</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f5<span class="sb">`</span>
        <span class="nb">echo</span> sudo apt-add-repository ppa:<span class="nv">$USER</span>/<span class="nv">$PPA</span>
    <span class="k">done</span>
<span class="k">done</span>
</pre></div>

<p>which looks rather initmidating initially. Let’s break it down part by part.</p>
<div class="highlight"><pre><span></span><span class="k">for</span> APT in <span class="sb">`</span>find /etc/apt/ -name <span class="se">\*</span>.list<span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
</pre></div>

<p>Uses the <code>find</code> command to look for any file with the extension <code>.list</code> under the <code>/etc/apt/</code> directory. The <code>for</code> loop then iterates over the filenames, storing the filename at each iteration in the <code>APT</code> variable.</p>
<p>Each of the <code>.list</code> files in the <code>/etc/apt/</code> directory contains lines similar to this:</p>
<div class="highlight"><pre><span></span>deb http://sg.archive.ubuntu.com/ubuntu/ trusty universe
</pre></div>

<p>You can read more about the format of the lines <a href="https://wiki.debian.org/SourcesList">here</a>. It’s amazing what a Google Search yields.</p>
<p>Moving on, this line:</p>
<div class="highlight"><pre><span></span>grep -o <span class="s2">&quot;^deb http://ppa.launchpad.net/[a-z0-9\-]\+/[a-z0-9\-]\+&quot;</span> <span class="nv">$APT</span>
</pre></div>

<p>Will look for the pattern <code>^deb http://ppa.launchpad.net/[a-z0-9\-]\+/[a-z0-9\-]\+</code> in the file whose name is stored inside the <code>APT</code> variable, and the <code>-o</code> flag for <code>grep</code> ensures that for each matching line, only the part of the line which conforms to the pattern will be printed.</p>
<p>If my description is confusing, fire up a text editor and enter the following line of text into a file named <code>abc.txt</code>:</p>
<div class="highlight"><pre><span></span>Hi, my name is John.
</pre></div>

<p>Then, run the following 2 commands and observe the difference in their output:</p>
<div class="highlight"><pre><span></span>grep <span class="s1">'my name'</span> abc.txt
grep -o <span class="s1">'my name'</span> abc.txt
</pre></div>

<p>For <code>grep 'my name' abc.txt</code>, the entire line <code>Hi, my name is John.</code> will be output. However, for <code>grep -o 'my name' abc.txt</code>, only the <code>my name</code> part will be output.</p>
<p>Now, this:</p>
<div class="highlight"><pre><span></span>grep -o <span class="s2">&quot;^deb http://ppa.launchpad.net/[a-z0-9\-]\+/[a-z0-9\-]\+&quot;</span> <span class="nv">$APT</span>
</pre></div>

<p>will result in a list of 0 or more lines being returned. Ok, I have to admit that I actually don’t know what’s the concrete data structure being returned by Bash. I’m just using list for simplification purposes.</p>
<p>Each of those lines, which is of the format <code>deb http://ppa.launchpad.net/PARTONE/PARTTWO</code> (with <code>PARTONE</code> and <code>PARTTWO</code> being two strings that match the <code>[a-z0-9\-]</code> regex) is fed to this loop:</p>
<div class="highlight"><pre><span></span><span class="k">while</span> <span class="nb">read</span> ENTRY <span class="p">;</span> <span class="k">do</span>
    <span class="nv">USER</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f4<span class="sb">`</span>
    <span class="nv">PPA</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f5<span class="sb">`</span>
    <span class="nb">echo</span> sudo apt-add-repository ppa:<span class="nv">$USER</span>/<span class="nv">$PPA</span>
end
</pre></div>

<p>which processes each of those matching lines, with the currently processed line stored in the <code>ENTRY</code> variable. Now, each line in entry is of this format:</p>
<div class="highlight"><pre><span></span>deb http://ppa.launchpad.net/PARTONE/PARTTWO
</pre></div>

<p>And this code:</p>
<div class="highlight"><pre><span></span><span class="nv">USER</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f4<span class="sb">`</span>
<span class="nv">PPA</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f5<span class="sb">`</span>
</pre></div>

<p>will use the <code>cut</code> command to process each line, treating each line as delimited by the <code>/</code> character, extracting the 4th and 5th fields (field counts start from 1) into the <code>USER</code> and <code>PPA</code> variables respectively. Using the string <code>deb http://ppa.launchpad.net/PARTONE/PARTTWO</code> as an example, the <code>USER</code> variable will contain the string <code>PARTONE</code> and the <code>PPA</code> variable will contain the string <code>PARTTWO</code>.</p>
<p>And finally, this line:</p>
<div class="highlight"><pre><span></span>echo sudo apt-add-repository ppa:$USER/$PPA
</pre></div>

<p>Echoes out <code>sudo apt-add-repository ppa:$USER/$PPA</code> depending on the values of the <code>USER</code> and <code>PPA</code> variables on each iteration of the <code>while</code> loop. Apparently, the intention of the person who asked the question (I feel very tempted to use ‘asker’ here) was to run the Bash script on an existing system and get it to output a list of <code>sudo apt-add-repository</code> commands that when run on a brand new system, will add all the PPAs that have been added on the existing system. However, that is not my intention so some modifications is in place. That said, we’ve solved our first step: Getting the list of added PPAs.</p>
<h2 id="storing-the-list-of-ppas-in-some-data-structure">Storing the list of PPAs in some data structure</h2>
<p>I immediately thought of using arrays since I recalled reading them somewhere in the past when I had to use Bash for larger scripts. So I needed to know how to append stuff to an array in Bash. A Google Search yields <a href="http://stackoverflow.com/a/1951523/732396">this answer on Stackoverflow</a>, the relevant code snippet being:</p>
<div class="highlight"><pre><span></span><span class="nv">ARRAY</span><span class="o">=()</span>
<span class="nv">ARRAY</span><span class="o">+=(</span><span class="s1">'foo'</span><span class="o">)</span>
<span class="nv">ARRAY</span><span class="o">+=(</span><span class="s1">'bar'</span><span class="o">)</span>
</pre></div>

<p>Ok, so I modified the first code snippet to:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">PPA_ARRAY</span><span class="o">=()</span>

<span class="k">for</span> APT in <span class="sb">`</span>find /etc/apt/ -name <span class="se">\*</span>.list<span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
    grep -o <span class="s2">&quot;^deb http://ppa.launchpad.net/[a-z0-9\-]\+/[a-z0-9\-]\+&quot;</span> <span class="nv">$APT</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> ENTRY <span class="p">;</span> <span class="k">do</span>
        <span class="nv">USER</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f4<span class="sb">`</span>
        <span class="nv">PPA</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f5<span class="sb">`</span>
        <span class="nv">PPA_ARRAY</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">/</span><span class="nv">$PPA</span><span class="s2">&quot;</span><span class="o">)</span>
    <span class="k">done</span>
<span class="k">done</span>
</pre></div>

<h2 id="checking-if-some-element-is-in-an-array">Checking if some element is in an array</h2>
<p>Our next order of business is to figure out if the git PPA has been added. So I needed to know how to determine if an element is present in a Bash array. A Google Search yields <a href="http://stackoverflow.com/a/8574392/732396">this answer on Stackoverflow</a> a function to do this:</p>
<div class="highlight"><pre><span></span>containsElement <span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> e
  <span class="k">for</span> e in <span class="s2">&quot;</span><span class="si">${</span><span class="p">@:</span><span class="nv">2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">do</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$e</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span> <span class="k">done</span>
  <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>
</pre></div>

<p>along with sample code:</p>
<div class="highlight"><pre><span></span><span class="nv">array</span><span class="o">=(</span><span class="s2">&quot;something to search for&quot;</span> <span class="s2">&quot;a string&quot;</span> <span class="s2">&quot;test2000&quot;</span><span class="o">)</span>
containsElement <span class="s2">&quot;a string&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>                   <span class="c1"># echo $? returns 0</span>
containsElement <span class="s2">&quot;blaha&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>                      <span class="c1"># echo $? returns 1</span>
</pre></div>

<p>Hmm, ok. So the latest code snippet becomes:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

containsElement <span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> e
  <span class="k">for</span> e in <span class="s2">&quot;</span><span class="si">${</span><span class="p">@:</span><span class="nv">2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">do</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$e</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span> <span class="k">done</span>
  <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="nv">PPA_ARRAY</span><span class="o">=()</span>

<span class="k">for</span> APT in <span class="sb">`</span>find /etc/apt/ -name <span class="se">\*</span>.list<span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
    grep -o <span class="s2">&quot;^deb http://ppa.launchpad.net/[a-z0-9\-]\+/[a-z0-9\-]\+&quot;</span> <span class="nv">$APT</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> ENTRY <span class="p">;</span> <span class="k">do</span>
        <span class="nv">USER</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f4<span class="sb">`</span>
        <span class="nv">PPA</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f5<span class="sb">`</span>
        <span class="nv">PPA_ARRAY</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">/</span><span class="nv">$PPA</span><span class="s2">&quot;</span><span class="o">)</span>
    <span class="k">done</span>
<span class="k">done</span>

<span class="k">if</span> ! containsElement <span class="s2">&quot;git-core/ppa&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PPA_ARRAY</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">then</span>
    sudo add-apt-repository ppa:git-core/ppa
    sudo apt-get update
<span class="k">fi</span>
</pre></div>

<p>So it should work, right? <strong>No.</strong> It got overzealous and just kept on adding the git PPA even after it was added.</p>
<h2 id="debugging">Debugging</h2>
<p>So some debugging is needed. How do I print a Bash array? A Google Search yields <a href="http://stackoverflow.com/a/15692004/732396">this answer on Stackoverflow</a>:</p>
<div class="highlight"><pre><span></span><span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">my_array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

<p>Ok. So I modified the code to include these debugging <code>printf</code>s, as well as commenting out some stuff:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

containsElement <span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> e
  <span class="k">for</span> e in <span class="s2">&quot;</span><span class="si">${</span><span class="p">@:</span><span class="nv">2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">do</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$e</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span> <span class="k">done</span>
  <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="nv">PPA_ARRAY</span><span class="o">=()</span>

<span class="k">for</span> APT in <span class="sb">`</span>find /etc/apt/ -name <span class="se">\*</span>.list<span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
    grep -o <span class="s2">&quot;^deb http://ppa.launchpad.net/[a-z0-9\-]\+/[a-z0-9\-]\+&quot;</span> <span class="nv">$APT</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> ENTRY <span class="p">;</span> <span class="k">do</span>
        <span class="nv">USER</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f4<span class="sb">`</span>
        <span class="nv">PPA</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f5<span class="sb">`</span>
        <span class="nv">PPA_ARRAY</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">/</span><span class="nv">$PPA</span><span class="s2">&quot;</span><span class="o">)</span>
        <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PPA_ARRAY</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">done</span>
<span class="k">done</span>

<span class="k">if</span> ! containsElement <span class="s2">&quot;git-core/ppa&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PPA_ARRAY</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">then</span>
<span class="c1">#    sudo add-apt-repository ppa:git-core/ppa</span>
<span class="c1">#    sudo apt-get update</span>
    <span class="nb">echo</span> <span class="s2">&quot;adding git-core/ppa&quot;</span>
<span class="k">fi</span>
</pre></div>

<p>Ok, I expected the size of the bash array to increase by 1 after each iteration. What I saw instead was, just single lines being printed. It was as if the <code>PPA_ARRAY</code> was being reset to empty at the start of each iteration of the <code>while</code> loop. So I added another <code>printf</code> statement after the <code>for</code> loop and… there was nothing. It just printed an empty line.</p>
<p>At this point, I was just… shocked. Wtf was happening?</p>
<h2 id="the-problem-and-the-solution">The problem and the solution</h2>
<p>I forgot what I googled, but I found <a href="http://stackoverflow.com/a/9985310/732396">this answer</a> by ruakh.</p>
<p>It turns out that, this part of the code:</p>
<div class="highlight"><pre><span></span>grep -o <span class="s2">&quot;^deb http://ppa.launchpad.net/[a-z0-9\-]\+/[a-z0-9\-]\+&quot;</span> <span class="nv">$APT</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> ENTRY <span class="p">;</span> <span class="k">do</span>
    <span class="nv">USER</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f4<span class="sb">`</span>
    <span class="nv">PPA</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f5<span class="sb">`</span>
    <span class="nv">PPA_ARRAY</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">/</span><span class="nv">$PPA</span><span class="s2">&quot;</span><span class="o">)</span>
    <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PPA_ARRAY</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">done</span>
</pre></div>

<p>causes the <code>while</code> loop to receive a new copy of the shell’s execution environment, including the <code>PPA_ARRAY</code> variable. That explains everything.</p>
<p>The solution then, is to use process substitution instead, like this:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> APT_LIST in <span class="sb">`</span>find /etc/apt/ -name <span class="se">\*</span>.list<span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
  <span class="k">while</span> <span class="nb">read</span> ENTRY<span class="p">;</span> <span class="k">do</span>
    <span class="nv">USER</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f4<span class="sb">`</span>
    <span class="nv">PPA</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$ENTRY</span> <span class="p">|</span> cut -d/ -f5<span class="sb">`</span>
    <span class="nv">PPA_ARRAY</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">/</span><span class="nv">$PPA</span><span class="s2">&quot;</span><span class="o">)</span>
  <span class="k">done</span> &lt; &lt;<span class="o">(</span>grep -o <span class="s1">'^deb http://ppa.launchpad.net/[a-z0-9\-]\+/[a-z0-9\-]\+'</span> <span class="nv">$APT_LIST</span><span class="o">)</span>
<span class="k">done</span>
</pre></div>

<p>You can see the resulting script <a href="https://github.com/yanhan/provision-ubuntu/blob/9972bc3b3477d7d754dd81430975318feefb7f60/run">here</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I always seem to learn something new each time I write a Bash script. Some day, I should compile some of the tips and tricks I’ve picked up along the way.</p>
<p>Anyways, this is my first technical blog post in slightly more than a year. Hurrah!</p>
</div>
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'pangyanhan'; // required: replace example with your forum shortname
        var disqus_identifier = "posts/2015-06-20-bash-stuff-that-i-recently-encountered.md";
        var disqus_url = "http://blog.pangyanhan.com/posts/2015-06-20-bash-stuff-that-i-recently-encountered.html";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>
        </div>

        <div class="row footer">
          <div class="medium-12 columns">
            <div class="footer-item">
              <span>Github</span>
              <a href="https://github.com/yanhan/">github.com/yanhan</a>
            </div>
            <div class="hakyll-line">
              Site proudly generated by
              <a href="http://jaspervdj.be/hakyll" target="_blank">Hakyll</a>
            </div>
          </div>
        </div>
      </div>

      <script src="../js/vendor/jquery.js"></script>
      <script src="../js/foundation.min.js"></script>
      <script>
        $(document).foundation();
        var navigation = responsiveNav(".nav-collapse", {
          animate: true,
          transition: 284,
          label: "",
          insert: "after",
          openPos: "relative",
          navActiveClass: "js-nav-active"
        });
      </script>
      <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-49506023-1', 'pangyanhan.com');ga('send', 'pageview');</script>
    </body>
</html>
